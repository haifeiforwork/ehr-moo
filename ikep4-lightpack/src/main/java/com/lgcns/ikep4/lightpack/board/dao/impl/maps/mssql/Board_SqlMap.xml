<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="lightpack.board.dao.board">
  <typeAlias alias="Board" type="com.lgcns.ikep4.lightpack.board.model.Board"/>
  <resultMap id="boardResult" class="com.lgcns.ikep4.lightpack.board.model.Board"> 
    <result column="BOARD_ID"           jdbcType="VARCHAR" property="boardId" />
    <result column="BOARD_PARENT_ID"    jdbcType="VARCHAR" property="boardParentId" />
    <result column="SORT_ORDER"         jdbcType="DECIMAL" property="sortOrder" />
    <result column="BOARD_NAME"         jdbcType="VARCHAR" property="boardName" />
    <result column="BOARD_ROOT_ID"      jdbcType="VARCHAR" property="boardRootId" />
    <result column="BOARD_DESCRIPTION"  jdbcType="VARCHAR" property="boardDescription" />
    <result column="BOARD_TYPE"         jdbcType="VARCHAR" property="boardType" />
    <result column="URL"                jdbcType="VARCHAR" property="url" />
    <result column="LIST_TYPE"          jdbcType="VARCHAR" property="listType" />
    <result column="ANONYMOUS"          jdbcType="DECIMAL" property="anonymous" />
    <result column="RSS"                jdbcType="DECIMAL" property="rss" />
    <result column="FILE_SIZE"          jdbcType="DECIMAL" property="fileSize" />
    <result column="IMAGE_FILE_SIZE"    jdbcType="DECIMAL" property="imageFileSize" />
    <result column="IMAGE_WIDTH"        jdbcType="DECIMAL" property="imageWidth" />
    <result column="PAGE_NUM"           jdbcType="DECIMAL" property="pageNum" />
    <result column="DOC_POPUP"          jdbcType="DECIMAL" property="docPopup" />
    <result column="REPLY"              jdbcType="DECIMAL" property="reply" />
    <result column="LINEREPLY"          jdbcType="DECIMAL" property="linereply" />
    <result column="RESTRICTION_TYPE"   jdbcType="VARCHAR" property="restrictionType" />
    <result column="READ_PERMISSION"    jdbcType="DECIMAL" property="readPermission" />
    <result column="WRITE_PERMISSION"   jdbcType="DECIMAL" property="writePermission" /> 
    <result column="ADMIN_PERMISSION"   jdbcType="DECIMAL" property="adminPermission" /> 
    <result column="BOARD_POPUP"        jdbcType="DECIMAL" property="boardPopup" /> 
    <result column="FILE_ATTACH_OPTION" jdbcType="DECIMAL" property="fileAttachOption" />
    <result column="ALLOW_TYPE"         jdbcType="VARCHAR" property="allowType" /> 
    <result column="PORTAL_ID"          jdbcType="VARCHAR" property="portalId" />
    <result column="PORTLET"            jdbcType="NUMBER"  property="portlet" />
    <result column="BOARD_DELETE"       jdbcType="NUMBER"  property="boardDelete" />
    <result column="REGISTER_ID"        jdbcType="VARCHAR" property="registerId" />
    <result column="REGISTER_NAME"      jdbcType="VARCHAR" property="registerName" />
    <result column="REGIST_DATE"        jdbcType="DATE"    property="registDate" />
    <result column="UPDATER_ID"         jdbcType="VARCHAR" property="updaterId" />
    <result column="UPDATER_NAME"       jdbcType="VARCHAR" property="updaterName" />
    <result column="UPDATE_DATE"        jdbcType="DATE"    property="updateDate" />
    <result column="BOARD_ENGLISH_NAME"         jdbcType="VARCHAR" property="boardEnglishName" />
    <result column="BOARD_ENGLISH_DESCRIPTION"  jdbcType="VARCHAR" property="boardEnglishDescription" />
    <result column="MOVE"				jdbcType="DECIMAL" property="move" />
    <result column="WORD_HEAD"			jdbcType="DECIMAL" property="wordHead" />
    <result column="CONTENTS_READ_PERMISSION"	jdbcType="DECIMAL" property="contentsReadPermission" nullValue="0"/>
    <result column="CONTENTS_READ_MAIL"	jdbcType="DECIMAL" property="contentsReadMail" nullValue="0"/>
    <result column="MOBILE_USE"	jdbcType="DECIMAL" property="mobileUse" nullValue="0"/>
    <result column="MOBILE_WRITE_USE"	jdbcType="DECIMAL" property="mobileWriteUse" nullValue="0"/>
    <result column="COLOR_USE"	jdbcType="DECIMAL" property="colorUse" nullValue="0"/>
  </resultMap>    

 <resultMap id="boardResult2" class="com.lgcns.ikep4.lightpack.board.model.Board"> 
    <result column="BOARD_ID"           jdbcType="VARCHAR" property="boardId" />
    <result column="BOARD_PARENT_ID"    jdbcType="VARCHAR" property="boardParentId" />
    <result column="SORT_ORDER"         jdbcType="DECIMAL" property="sortOrder" />
    <result column="BOARD_NAME"         jdbcType="VARCHAR" property="boardName" />
    <result column="BOARD_ROOT_ID"      jdbcType="VARCHAR" property="boardRootId" />
    <result column="BOARD_DESCRIPTION"  jdbcType="VARCHAR" property="boardDescription" />
    <result column="BOARD_TYPE"         jdbcType="VARCHAR" property="boardType" />
    <result column="URL"                jdbcType="VARCHAR" property="url" />
    <result column="LIST_TYPE"          jdbcType="VARCHAR" property="listType" />
    <result column="ANONYMOUS"          jdbcType="DECIMAL" property="anonymous" />
    <result column="RSS"                jdbcType="DECIMAL" property="rss" />
    <result column="FILE_SIZE"          jdbcType="DECIMAL" property="fileSize" />
    <result column="IMAGE_FILE_SIZE"    jdbcType="DECIMAL" property="imageFileSize" />
    <result column="IMAGE_WIDTH"        jdbcType="DECIMAL" property="imageWidth" />
    <result column="PAGE_NUM"           jdbcType="DECIMAL" property="pageNum" />
    <result column="DOC_POPUP"          jdbcType="DECIMAL" property="docPopup" />
    <result column="REPLY"              jdbcType="DECIMAL" property="reply" />
    <result column="LINEREPLY"          jdbcType="DECIMAL" property="linereply" />
    <result column="RESTRICTION_TYPE"   jdbcType="VARCHAR" property="restrictionType" />
    <result column="READ_PERMISSION"    jdbcType="DECIMAL" property="readPermission" />
    <result column="WRITE_PERMISSION"   jdbcType="DECIMAL" property="writePermission" /> 
    <result column="ADMIN_PERMISSION"   jdbcType="DECIMAL" property="adminPermission" /> 
    <result column="BOARD_POPUP"        jdbcType="DECIMAL" property="boardPopup" /> 
    <result column="FILE_ATTACH_OPTION" jdbcType="DECIMAL" property="fileAttachOption" />
    <result column="ALLOW_TYPE"         jdbcType="VARCHAR" property="allowType" /> 
    <result column="PORTAL_ID"          jdbcType="VARCHAR" property="portalId" />
    <result column="PORTLET"            jdbcType="NUMBER"  property="portlet" />
    <result column="VIEW_COUNT"         jdbcType="VARCHAR"  property="viewCount" />
    <result column="BOARD_DELETE"       jdbcType="NUMBER"  property="boardDelete" />
    <result column="REGISTER_ID"        jdbcType="VARCHAR" property="registerId" />
    <result column="REGISTER_NAME"      jdbcType="VARCHAR" property="registerName" />
    <result column="REGIST_DATE"        jdbcType="DATE"    property="registDate" />
    <result column="UPDATER_ID"         jdbcType="VARCHAR" property="updaterId" />
    <result column="UPDATER_NAME"       jdbcType="VARCHAR" property="updaterName" />
    <result column="UPDATE_DATE"        jdbcType="DATE"    property="updateDate" />
    <result column="BOARD_ENGLISH_NAME"         jdbcType="VARCHAR" property="boardEnglishName" />
    <result column="BOARD_ENGLISH_DESCRIPTION"  jdbcType="VARCHAR" property="boardEnglishDescription" />
  </resultMap>                          
  <resultMap id="boardMarkResult" class="com.lgcns.ikep4.lightpack.board.model.Board"> 
    <result column="BOARD_ID"           jdbcType="VARCHAR" property="boardId" />
    <result column="BOARD_PARENT_ID"    jdbcType="VARCHAR" property="boardParentId" />
    <result column="SORT_ORDER"         jdbcType="DECIMAL" property="sortOrder" />
    <result column="BOARD_NAME"         jdbcType="VARCHAR" property="boardName" />
    <result column="BOARD_ROOT_ID"      jdbcType="VARCHAR" property="boardRootId" />
    <result column="BOARD_DESCRIPTION"  jdbcType="VARCHAR" property="boardDescription" />
    <result column="BOARD_TYPE"         jdbcType="VARCHAR" property="boardType" />
    <result column="URL"                jdbcType="VARCHAR" property="url" />
    <result column="LIST_TYPE"          jdbcType="VARCHAR" property="listType" />
    <result column="ANONYMOUS"          jdbcType="DECIMAL" property="anonymous" />
    <result column="RSS"                jdbcType="DECIMAL" property="rss" />
    <result column="FILE_SIZE"          jdbcType="DECIMAL" property="fileSize" />
    <result column="IMAGE_FILE_SIZE"    jdbcType="DECIMAL" property="imageFileSize" />
    <result column="IMAGE_WIDTH"        jdbcType="DECIMAL" property="imageWidth" />
    <result column="PAGE_NUM"           jdbcType="DECIMAL" property="pageNum" />
    <result column="DOC_POPUP"          jdbcType="DECIMAL" property="docPopup" />
    <result column="REPLY"              jdbcType="DECIMAL" property="reply" />
    <result column="LINEREPLY"          jdbcType="DECIMAL" property="linereply" />
    <result column="RESTRICTION_TYPE"   jdbcType="VARCHAR" property="restrictionType" />
    <result column="READ_PERMISSION"    jdbcType="DECIMAL" property="readPermission" />
    <result column="WRITE_PERMISSION"   jdbcType="DECIMAL" property="writePermission" /> 
    <result column="ADMIN_PERMISSION"   jdbcType="DECIMAL" property="adminPermission" /> 
    <result column="BOARD_POPUP"        jdbcType="DECIMAL" property="boardPopup" /> 
    <result column="FILE_ATTACH_OPTION" jdbcType="DECIMAL" property="fileAttachOption" />
    <result column="ALLOW_TYPE"         jdbcType="VARCHAR" property="allowType" /> 
    <result column="PORTAL_ID"          jdbcType="VARCHAR" property="portalId" />
    <result column="PORTLET"            jdbcType="NUMBER"  property="portlet" />
    <result column="VIEW_COUNT"         jdbcType="VARCHAR"  property="viewCount" />
    <result column="BOARD_DELETE"       jdbcType="NUMBER"  property="boardDelete" />
    <result column="REGISTER_ID"        jdbcType="VARCHAR" property="registerId" />
    <result column="REGISTER_NAME"      jdbcType="VARCHAR" property="registerName" />
    <result column="REGIST_DATE"        jdbcType="DATE"    property="registDate" />
    <result column="UPDATER_ID"         jdbcType="VARCHAR" property="updaterId" />
    <result column="UPDATER_NAME"       jdbcType="VARCHAR" property="updaterName" />
    <result column="UPDATE_DATE"        jdbcType="DATE"    property="updateDate" />
    <result column="BOARD_ENGLISH_NAME"         jdbcType="VARCHAR" property="boardEnglishName" />
    <result column="BOARD_ENGLISH_DESCRIPTION"  jdbcType="VARCHAR" property="boardEnglishDescription" />
  </resultMap>
                      
  <resultMap id="boardIndentationResult" extends="boardResult" class="com.lgcns.ikep4.lightpack.board.model.Board"> 
    <result column="INDENTATION" jdbcType="VARCHAR" property="indentation" /> 
    <result column="HAS_CHILDREN" jdbcType="DECIMAL" property="hasChildren" />
  </resultMap> 
  <resultMap id="boardResultEx" extends="boardResult"  class="com.lgcns.ikep4.lightpack.board.model.Board">  
    <result column="HAS_CHILDREN" jdbcType="DECIMAL" property="hasChildren" />
  </resultMap>
  
  <resultMap id="boardMenuResult" class="com.lgcns.ikep4.lightpack.board.model.Board">
  	<result column="BOARD_ID"           	jdbcType="VARCHAR" 	property="boardId" />
    <result column="BOARD_NAME"     jdbcType="VARCHAR"	property="boardName" />
  </resultMap>
  
  <sql id="sqlColumnList">
    BOARD_ID, 
    BOARD_PARENT_ID,
    SORT_ORDER, 
    BOARD_NAME, 
    BOARD_ROOT_ID, 
    BOARD_DESCRIPTION, 
    BOARD_TYPE, 
    URL, 
    LIST_TYPE, 
    ANONYMOUS,
    RSS, 
    FILE_SIZE, 
    IMAGE_FILE_SIZE, 
    IMAGE_WIDTH, 
    PAGE_NUM, 
    DOC_POPUP, 
    REPLY, 
    LINEREPLY, 
    RESTRICTION_TYPE, 
    READ_PERMISSION, 
    WRITE_PERMISSION, 
    ADMIN_PERMISSION, 
    BOARD_POPUP,     
    FILE_ATTACH_OPTION,
    ALLOW_TYPE,        
    PORTAL_ID, 
    PORTLET,
    BOARD_DELETE,
    REGISTER_ID, 
    REGISTER_NAME, 
    REGIST_DATE, 
    UPDATER_ID, 
    UPDATER_NAME, 
    UPDATE_DATE,
    BOARD_ENGLISH_NAME,
    BOARD_ENGLISH_DESCRIPTION,
    MOVE,
    WORD_HEAD,
    CONTENTS_READ_PERMISSION,
    CONTENTS_READ_MAIL,
    MOBILE_USE,
    MOBILE_WRITE_USE,
    COLOR_USE
  </sql> 
  <sql id="sqlmarkColumnList">
    PORTLET_CONFIG_ID,
    BOARD_ID, 
    VIEW_COUNT, 
    REGISTER_ID, 
    REGIST_DATE, 
    UPDATER_ID, 
    UPDATE_DATE 
  </sql> 
  <sql id="sqlmarkColumnList2">
    A.BOARD_ID, 
    A.BOARD_PARENT_ID,
    A.SORT_ORDER, 
    A.BOARD_NAME, 
    A.BOARD_ROOT_ID, 
    A.BOARD_DESCRIPTION, 
    A.BOARD_TYPE, 
    A.URL, 
    A.LIST_TYPE, 
    A.ANONYMOUS,
    A.RSS, 
    A.FILE_SIZE, 
    A.IMAGE_FILE_SIZE, 
    A.IMAGE_WIDTH, 
    A.PAGE_NUM, 
    A.DOC_POPUP, 
    A.REPLY, 
    A.LINEREPLY, 
    A.RESTRICTION_TYPE, 
    A.READ_PERMISSION, 
    A.WRITE_PERMISSION,  
    A.ADMIN_PERMISSION, 
    A.BOARD_POPUP,     
    A.FILE_ATTACH_OPTION,
    A.ALLOW_TYPE,        
    A.PORTAL_ID, 
    A.PORTLET,
	(SELECT max(VIEW_COUNT) 
	FROM IKEP4_PO_PORTLET_MARKBOARD C 
	WHERE C.BOARD_ID = B.BOARD_ID AND C.PORTLET_CONFIG_ID = B.PORTLET_CONFIG_ID
	) VIEW_COUNT,    
    A.BOARD_DELETE,
    A.REGISTER_ID, 
    A.REGISTER_NAME, 
    A.REGIST_DATE, 
    A.UPDATER_ID, 
    A.UPDATER_NAME, 
    A.UPDATE_DATE,
    A.BOARD_ENGLISH_NAME,
    A.BOARD_ENGLISH_DESCRIPTION
  </sql> 

  <select id="getParents" parameterClass="string" resultMap="boardResult">
  	WITH CTE AS (
  		SELECT 	1 LEV, *
		FROM  	IKEP4_BD_BOARD
		WHERE 	BOARD_DELETE = 0
			AND	BOARD_ID =  #boardId#
		UNION ALL
		SELECT	LEV + 1, TBL.*
		FROM  	IKEP4_BD_BOARD TBL, CTE
		WHERE 	TBL.BOARD_DELETE = 0
			AND	CTE.BOARD_PARENT_ID = TBL.BOARD_ID
  	)
	SELECT /* [Board_SqlMap.xml] lightpack.board.dao.board.getParents */
	      <include refid="lightpack.board.dao.board.sqlColumnList" />  
 	FROM (
		SELECT LEV, <include refid="lightpack.board.dao.board.sqlColumnList" />
		FROM  CTE
	) TBL
	ORDER BY LEV DESC
  </select>
  
  <!-- ANSI -->
  <select id="getChildren" parameterClass="string" resultMap="boardResult">
	SELECT /* [Board_SqlMap.xml] lightpack.board.dao.board.getChildren */
	       <include refid="lightpack.board.dao.board.sqlColumnList" />
 	FROM  IKEP4_BD_BOARD
	WHERE BOARD_PARENT_ID = #boardId#
	AND   BOARD_DELETE = 0
  </select>
  
    <!-- MS SQL -->
  <select id="readHasPermissionBoard" parameterClass="string" resultMap="boardResult"> 
	SELECT /* [Board_SqlMap.xml] lightpack.board.dao.board.get */  TOP 1 *
	FROM (
		SELECT  <include refid="lightpack.board.dao.board.sqlColumnList" />
		FROM   IKEP4_BD_BOARD 
		WHERE  BOARD_ROOT_ID = #boardRootId#
		AND    BOARD_PARENT_ID IS NULL 
		AND    BOARD_TYPE = 0
		AND    BOARD_DELETE = 0
	) TBL
	ORDER BY SORT_ORDER ASC
  </select>
  
  <!-- ANSI -->
  <select id="get" parameterClass="string" resultMap="boardResult">
    SELECT /* [Board_SqlMap.xml] lightpack.board.dao.board.get */ 
    <include refid="lightpack.board.dao.board.sqlColumnList" />
    FROM  IKEP4_BD_BOARD
    WHERE BOARD_ID = #boardId#
  </select>
  
  <!-- MS SQL -->
  <select id="nextDeletedBoard" resultMap="boardResult">
    SELECT /* [Board_SqlMap.xml] lightpack.board.dao.board.nextDeletedBoard */ 
    		TOP 1 <include refid="lightpack.board.dao.board.sqlColumnList" />
    FROM  IKEP4_BD_BOARD
    WHERE BOARD_DELETE = 1
  </select>  
  
  <!-- ANSI -->
  <select id="exists" parameterClass="string" resultClass="int">
    SELECT /* [Board_SqlMap.xml] lightpack.board.dao.board.exists */
    	  COUNT(*)
    FROM  IKEP4_BD_BOARD
    WHERE BOARD_ID = #boardId#
  </select>
  
  <!-- ANSI -->
  <select id="listBySelectedBoardForPublicBoard" parameterClass="string" resultMap="boardResult"> 
	SELECT /* [Board_SqlMap.xml] lightpack.board.dao.board.listBySelectedBoardForPublicBoard */ 
	       <include refid="lightpack.board.dao.board.sqlColumnList"/>
	FROM   IKEP4_BD_BOARD  A
	WHERE  PORTLET = 1 
	AND    BOARD_DELETE = 0
	ORDER BY SORT_ORDER ASC
  </select>
  
  <select id="listByBoardRootIdMap" parameterClass="Map" resultClass="Board">
		SELECT /* [Board_SqlMap.xml] lightpack.board.dao.board.listByBoardRootIdMap */ 
			 BOARD_ID		boardId,
			BOARD_PARENT_ID	boardParentId,
			BOARD_NAME		boardName,
			BOARD_TYPE		boardType,
			URL				url,
			LIST_TYPE		listType,
			PORTAL_ID		portalId,
			SORT_ORDER		sortOrder,
			BOARD_ROOT_ID	boardRootId
		FROM
			IKEP4_BD_BOARD
		WHERE  BOARD_ROOT_ID   = #boardRootId# 
	      AND BOARD_DELETE=0
		ORDER BY 
			SORT_ORDER ASC
	</select>
	
<!-- 수정해야함 -->	
  <select id="listByBoardRootIdPermission" parameterClass="map" resultMap="boardIndentationResult"> 

	/* [Board_SqlMap.xml] lightpack.board.dao.board.listByBoardRootId */		
  	WITH CTE AS (
  		SELECT 	CONVERT(NVARCHAR, '/' + CONVERT(VARCHAR, SORT_ORDER+1000)) PATH_ORDER,
  				1 INDENTATION,
		       	A1.*
       	FROM 	IKEP4_BD_BOARD  A1 inner join 
			 IKEP4_VW_PERMIT_SYS_RESOURCE B on A1.BOARD_ID  = B.RESOURCE_NAME
		WHERE	BOARD_ROOT_ID = #boardRootId# 
			AND PORTAL_Id = #portalId#
			AND	BOARD_DELETE = 0
	    	AND	BOARD_PARENT_ID is null
	    	AND B.OPERATION_NAME IN ('READ')
	    	AND B.CLASS_NAME='BBS-Board'
	    	AND B.USER_ID IN (#userId#, 'OPEN')	     
	    UNION ALL
	    SELECT	CONVERT(NVARCHAR, CTE.PATH_ORDER + '/' + CONVERT(VARCHAR, A2.SORT_ORDER+1000)) PATH_ORDER,
	    		INDENTATION + 1,
		       	A2.*
		FROM	IKEP4_BD_BOARD A2 
			    ,CTE
			    ,IKEP4_VW_PERMIT_SYS_RESOURCE B
		WHERE	A2.BOARD_ROOT_ID = #boardRootId# 
			AND	A2.BOARD_DELETE = 0
			AND A2.BOARD_ID  = B.RESOURCE_NAME
			AND B.OPERATION_NAME IN ('READ')
	    	AND B.CLASS_NAME='BBS-Board'
	    	AND B.USER_ID IN (#userId#, 'OPEN')	     
			AND	CTE.BOARD_ID = A2.BOARD_PARENT_ID 
  	)
	SELECT INDENTATION,
	       (SELECT	COUNT(*) FROM IKEP4_BD_BOARD B WHERE CTE.BOARD_ID = B.BOARD_PARENT_ID AND B.BOARD_DELETE = 0) AS HAS_CHILDREN,
	       <include refid="lightpack.board.dao.board.sqlColumnList"/>
	FROM CTE
	ORDER BY PATH_ORDER 
	
  </select>	
  
  <!-- MS SQL -->
  <select id="listByBoardRootId" parameterClass="map" resultMap="boardIndentationResult"> 
	/* [Board_SqlMap.xml] lightpack.board.dao.board.listByBoardRootId */		
  	WITH CTE AS (
  		SELECT 	CONVERT(NVARCHAR, '/' + CONVERT(VARCHAR, SORT_ORDER+1000)) PATH_ORDER,
  				1 INDENTATION,
		       	A1.*
       	FROM 	IKEP4_BD_BOARD  A1
		WHERE	BOARD_ROOT_ID = #boardRootId# 
			AND PORTAL_Id = #portalId#
			AND	BOARD_DELETE = 0
	    	AND	BOARD_PARENT_ID is null
	    UNION ALL
	    SELECT	CONVERT(NVARCHAR, CTE.PATH_ORDER + '/' + CONVERT(VARCHAR, A2.SORT_ORDER+1000)) PATH_ORDER,
	    		INDENTATION + 1,
		       	A2.*
		FROM	IKEP4_BD_BOARD A2, CTE
		WHERE	A2.BOARD_ROOT_ID = #boardRootId# 
			AND	A2.BOARD_DELETE = 0
			AND	CTE.BOARD_ID = A2.BOARD_PARENT_ID 
  	)
	SELECT INDENTATION,
	       (SELECT	COUNT(*) FROM IKEP4_BD_BOARD B WHERE CTE.BOARD_ID = B.BOARD_PARENT_ID AND B.BOARD_DELETE = 0) AS HAS_CHILDREN,
	       <include refid="lightpack.board.dao.board.sqlColumnList"/>
	FROM CTE
	ORDER BY PATH_ORDER 
  </select>
  
  <!-- ANSI -->
  <select id="listBoardTypeBoard" resultMap="boardResult"> 
	SELECT /* [Board_SqlMap.xml] lightpack.board.dao.board.listBoardTypeBoard */ 
	      <include refid="lightpack.board.dao.board.sqlColumnList"/>
	FROM  IKEP4_BD_BOARD 
	WHERE BOARD_TYPE = 0
	AND   BOARD_DELETE = 0
	ORDER BY BOARD_NAME
  </select>
  
  <!-- ANSI -->
  <select id="listChildrenBoard" parameterClass="string" resultMap="boardResultEx">
	SELECT /* [Board_SqlMap.xml] lightpack.board.dao.board.listChildrenBoard */ 
	<include refid="lightpack.board.dao.board.sqlColumnList"/>,
	       (SELECT COUNT(*) FROM IKEP4_BD_BOARD B WHERE A.BOARD_ID = B.BOARD_PARENT_ID AND B.BOARD_DELETE = 0) AS HAS_CHILDREN
    FROM   IKEP4_BD_BOARD A
    <isNotEmpty>
		WHERE BOARD_PARENT_ID = #boardId#
		AND   BOARD_DELETE = 0
	</isNotEmpty>
    <isEmpty>
		WHERE BOARD_PARENT_ID IS NULL
		AND   BOARD_DELETE = 0
	</isEmpty>	
    ORDER BY SORT_ORDER ASC
  </select>
  
 <!-- 수정해야함 -->
  <select id="listChildrenBoardPortal" parameterClass="map" resultMap="boardResultEx">
	SELECT /* [Board_SqlMap.xml] lightpack.board.dao.board.listChildrenBoard */ 
	<include refid="lightpack.board.dao.board.sqlColumnList"/>,
	       (SELECT COUNT(*) FROM IKEP4_BD_BOARD B WHERE A.BOARD_ID = B.BOARD_PARENT_ID) AS HAS_CHILDREN
    FROM   IKEP4_BD_BOARD A
    <isNotEmpty property="boardId">
		WHERE BOARD_PARENT_ID = #boardId#
		AND   BOARD_DELETE = 0
	</isNotEmpty>
    <isEmpty property="boardId">
		WHERE BOARD_PARENT_ID IS NULL
		AND   BOARD_DELETE = 0
	</isEmpty>	
		AND    PORTAL_ID = #portalId#
    ORDER BY SORT_ORDER ASC
  </select>
  
  <!-- ANSI -->
  <insert id="create" parameterClass="Board">
    INSERT INTO IKEP4_BD_BOARD ( /* [board_SqlMap.xml] lightpack.board.dao.board.insert */
     <include refid="lightpack.board.dao.board.sqlColumnList" />
    ) 
    SELECT 
      #boardId#,
      #boardParentId#,   
      ISNULL(MAX(A.SORT_ORDER), -1) + 1,
      #boardName#,        
      #boardRootId#,      
      #boardDescription#, 
      #boardType#,        
      #url#,    
      #listType#,         
      #anonymous#,        
      #rss#,    
      #fileSize#,         
      #imageFileSize#,    
      #imageWidth#,       
      #pageNum#,
      #docPopup#,         
      #reply#,  
      #linereply#,        
      #restrictionType#,  
      #readPermission#,   
      #writePermission#,  
      #adminPermission#,
      #boardPopup#, 
      #fileAttachOption#,  
      #allowType#, 
      #portalId#,   
      #portlet#,     
      #boardDelete#, 
      #registerId#,       
      #registerName#,     
      CURRENT_TIMESTAMP,       
      #updaterId#,        
      #updaterName#,      
      CURRENT_TIMESTAMP,
      #boardEnglishName#,
      #boardEnglishDescription#,
      #move#,
      #wordHead#,
      #contentsReadPermission#,
      #contentsReadMail#,
      #mobileUse#,
      #mobileWriteUse#,
      #colorUse#
      FROM	IKEP4_BD_BOARD A
      <isNotEmpty property="boardParentId">
	  WHERE A.BOARD_PARENT_ID = #boardParentId#  
	  </isNotEmpty>
      <isEmpty property="boardParentId">
	  WHERE A.BOARD_PARENT_ID IS NULL  
	  </isEmpty> 
  </insert>
  
  <!-- ANSI -->
  <update id="updateBoardDeleteField" parameterClass="map">
    UPDATE IKEP4_BD_BOARD /* [board_SqlMap.xml] lightpack.board.dao.board.updateBoardDeleteField */
    SET    BOARD_DELETE  =  #status#
    WHERE  BOARD_ID = #boardId#
  </update>

  <!-- ANSI -->
  <update id="updateMove" parameterClass="Board">
    UPDATE IKEP4_BD_BOARD /* [board_SqlMap.xml] lightpack.board.dao.board.updateMove */
    SET    BOARD_PARENT_ID  =  #boardParentId#,
           SORT_ORDER       =  #sortOrder#, 
           UPDATER_ID       =  #updaterId#,
           UPDATER_NAME     =  #updaterName#,
           UPDATE_DATE      =  CURRENT_TIMESTAMP  
    WHERE  BOARD_ID = #boardId#
  </update>      

  <!-- ANSI -->
  <update id="updateRemovePortlet">
    UPDATE IKEP4_BD_BOARD /* [board_SqlMap.xml] lightpack.board.dao.board.updateRemovePortlet */
    SET    PORTLET  = 0
  </update>  
   
  <!-- ANSI -->
  <update id="updateSetupPortlet" parameterClass="string">
    UPDATE IKEP4_BD_BOARD /* [board_SqlMap.xml] lightpack.board.dao.board.updateSetupPortlet */
    SET    PORTLET  = 1 
    WHERE  BOARD_ID = #boardId#
  </update> 
  
    <!-- ANSI -->
  <update id="updateSortOderIncrease" parameterClass="Board">
    UPDATE IKEP4_BD_BOARD /* [board_SqlMap.xml] lightpack.board.dao.board.updateSortOderIncrease */
    SET    SORT_ORDER      =  SORT_ORDER + 1
    WHERE  1 = 1
    <isEmpty property="boardParentId">
    AND  BOARD_PARENT_ID IS NULL
    </isEmpty>
    <isNotEmpty property="boardParentId">
    AND  BOARD_PARENT_ID = #boardParentId#
    </isNotEmpty>
    AND    SORT_ORDER &gt;= #sortOrder#
  </update>   
 
  <!-- ANSI -->
  <update id="updateSortOderDecrease" parameterClass="Board">
    UPDATE IKEP4_BD_BOARD /* [board_SqlMap.xml] lightpack.board.dao.board.updateSortOderDecrease */
    SET    SORT_ORDER      =  SORT_ORDER - 1
    WHERE  1 = 1
    <isEmpty property="boardParentId">
    AND  BOARD_PARENT_ID IS NULL
    </isEmpty>
    <isNotEmpty property="boardParentId">
    AND  BOARD_PARENT_ID = #boardParentId#
    </isNotEmpty>
    AND    SORT_ORDER &gt; #sortOrder#
  </update> 
  
  <!-- ANSI -->
  <update id="update" parameterClass="Board">
    UPDATE IKEP4_BD_BOARD /* [board_SqlMap.xml] lightpack.board.dao.board.update */
    SET    BOARD_ID           =  #boardId#,
           BOARD_PARENT_ID    =  #boardParentId#,
           SORT_ORDER         =  #sortOrder#,
           BOARD_NAME         =  #boardName#,
           BOARD_ROOT_ID      =  #boardRootId#,
           BOARD_DESCRIPTION  =  #boardDescription#,
           BOARD_TYPE         =  #boardType#,
           URL                =  #url#,
           LIST_TYPE          =  #listType#,
           ANONYMOUS          =  #anonymous#,
           RSS                =  #rss#,
           FILE_SIZE          =  #fileSize#,
           IMAGE_FILE_SIZE    =  #imageFileSize#,
           IMAGE_WIDTH        =  #imageWidth#,
           PAGE_NUM           =  #pageNum#,
           DOC_POPUP          =  #docPopup#,
           REPLY              =  #reply#,
           LINEREPLY          =  #linereply#,
           RESTRICTION_TYPE   =  #restrictionType#,
           READ_PERMISSION    =  #readPermission#,
           WRITE_PERMISSION   =  #writePermission#, 
           ADMIN_PERMISSION   =  #adminPermission#,
           BOARD_POPUP        =  #boardPopup#,
    	   FILE_ATTACH_OPTION =  #fileAttachOption#,   
   		   ALLOW_TYPE         =  #allowType#,  
           PORTAL_ID          =  #portalId#, 
           PORTLET            =  #portlet#,
           BOARD_DELETE       =  #boardDelete#,
           UPDATER_ID         =  #updaterId#,
           UPDATER_NAME       =  #updaterName#,
           UPDATE_DATE        =  CURRENT_TIMESTAMP ,
           BOARD_ENGLISH_NAME =  #boardEnglishName#,
      	   BOARD_ENGLISH_DESCRIPTION =  #boardEnglishDescription#,
      	   MOVE			      =	#move#,
      	   WORD_HEAD			  =	#wordHead#,
      	   CONTENTS_READ_PERMISSION = #contentsReadPermission#,
           CONTENTS_READ_MAIL =#contentsReadMail#,
           MOBILE_USE = #mobileUse#,
     	   MOBILE_WRITE_USE =#mobileWriteUse#
    WHERE  BOARD_ID = #boardId#
  </update> 
  
  <!-- ANSI -->
  <delete id="physicalDelete" parameterClass="string">
    DELETE FROM IKEP4_BD_BOARD /* [board_SqlMap.xml] lightpack.board.dao.board.physicalDelete */
    WHERE  BOARD_ID = #boardId#
  </delete>
  
  <select id="selectBoardMenuType" resultClass="String">
  	select val from ikep4_bd_config where code = 'MENU_TYPE'
  </select>
  
  <update id="updateBoardMenuType" parameterClass="String">
  	update ikep4_bd_config set val = #type#
  	where code = 'MENU_TYPE'
  </update>
  
  <!-- MarkBoard 처리용-->
  <select id="listBySelectedBoardForMarkBoard" parameterClass="string" resultClass="Board">
  	/* [Board_SqlMap.xml] lightpack.board.dao.board.listBySelectedBoardForMarkBoard */  
	SELECT 
		   A.BOARD_ID  boardId,
		   A.BOARD_NAME  boardName,
	       B.VIEW_COUNT  viewCount
	FROM   IKEP4_BD_BOARD  A INNER JOIN IKEP4_PO_PORTLET_MARKBOARD B ON A.BOARD_ID = B.BOARD_ID
	WHERE  B.PORTLET_CONFIG_ID = #portletConfigId#
	AND    BOARD_DELETE = 0
  </select>
  
  <select id="listBoardTypeBoardmark" parameterClass="map" resultClass="Board"> 
WITH CTE AS (
  		SELECT 	CONVERT(NVARCHAR, '/' + CONVERT(VARCHAR, SORT_ORDER+1000)) PATH_ORDER,
  				1 INDENTATION,
		       	A1.*
       	FROM 	IKEP4_BD_BOARD  A1 inner join 
			 IKEP4_VW_PERMIT_SYS_RESOURCE B on A1.BOARD_ID  = B.RESOURCE_NAME
		WHERE	BOARD_ROOT_ID = #boardRootId# 
			AND PORTAL_Id = #portalId#
			AND	BOARD_DELETE = 0
	    	AND	BOARD_PARENT_ID is null
	    	AND B.OPERATION_NAME IN ('READ')
	    	AND B.CLASS_NAME='BBS-Board'
	    	AND B.USER_ID IN (#userId#, 'OPEN')	     
	    UNION ALL
	    SELECT	CONVERT(NVARCHAR, CTE.PATH_ORDER + '/' + CONVERT(VARCHAR, A2.SORT_ORDER+1000)) PATH_ORDER,
	    		INDENTATION + 1,
		       	A2.*
		FROM	IKEP4_BD_BOARD A2 
			    ,CTE
			    ,IKEP4_VW_PERMIT_SYS_RESOURCE B
		WHERE	A2.BOARD_ROOT_ID = #boardRootId# 
			AND	A2.BOARD_DELETE = 0
			AND A2.BOARD_ID  = B.RESOURCE_NAME
			AND B.OPERATION_NAME IN ('READ')
	    	AND B.CLASS_NAME='BBS-Board'
	    	AND B.USER_ID IN (#userId#, 'OPEN')	     
			AND	CTE.BOARD_ID = A2.BOARD_PARENT_ID 
  	)
	SELECT   BOARD_ID  boardId, 
	       BOARD_NAME  boardName, 
	     (SELECT COUNT(BOARD_ID) 
	         FROM IKEP4_PO_PORTLET_MARKBOARD B 
	        WHERE B.BOARD_ID = CTE.BOARD_ID 
	          AND B.PORTLET_CONFIG_ID = #portletConfigId#
	       ) portlet, 
	 	       (SELECT max(VIEW_COUNT) 
	         FROM IKEP4_PO_PORTLET_MARKBOARD B 
	        WHERE B.BOARD_ID = CTE.BOARD_ID 
	          AND B.PORTLET_CONFIG_ID = #portletConfigId#
	       ) viewCount 
	FROM CTE where BOARD_TYPE = 0 
	   AND BOARD_DELETE = 0 
	   AND BOARD_ID NOT IN ('100000793108','100000793116')
	ORDER BY BOARD_NAME 
  </select>
  
  <delete id="deleteSetupPortletMark" parameterClass="string">
  	/* [board_SqlMap.xml] lightpack.board.dao.board.deleteSetupPortletMark */
    DELETE FROM IKEP4_PO_PORTLET_MARKBOARD 
	 WHERE PORTLET_CONFIG_ID = #portletConfigId#
  </delete>
  
  <insert id="createSetupPortletMark" parameterClass="map">
  	/* [board_SqlMap.xml] lightpack.board.dao.board.updateSetupPortletMark */
    INSERT INTO IKEP4_PO_PORTLET_MARKBOARD ( 
      PORTLET_CONFIG_ID,
      BOARD_ID, 
      VIEW_COUNT, 
      REGISTER_ID, 
      REGIST_DATE, 
      UPDATER_ID, 
      UPDATE_DATE
    ) VALUES (
      #portletConfigId#,
      #boardId#,
      #viewCount#,
      #registerId#,       
      CURRENT_TIMESTAMP,       
      #updaterId#,        
      CURRENT_TIMESTAMP
    )
  </insert>  
  
  <update id="updateDisplayBoardParentItem" parameterClass="String">
  <![CDATA[
  	update IKEP4_BD_ITEM
	set item_display = '0', dis_start_date = null, dis_end_date = null
	where item_display = '1'
	and dis_end_date < getdate()
	and step = '0'
	]]>
  </update>
  
  <update id="updateDisplayBoardItem" parameterClass="String">
  <![CDATA[
  	update IKEP4_BD_ITEM
	set item_display = '0', dis_start_date = null, dis_end_date = null
	where item_display = '1'
	and step <> '0'
	and item_group_id in(select item_id from IKEP4_BD_ITEM where step = '0' and item_display = '0')
  ]]>
  </update>
  
  <select id="listByBoardRootIdMobile" parameterClass="map" resultMap="boardIndentationResult"> 
    /* [Board_SqlMap.xml] lightpack.board.dao.board.listByBoardRootId */		
  	WITH CTE AS (
  		SELECT 	CONVERT(NVARCHAR, '/' + CONVERT(VARCHAR, SORT_ORDER+1000)) PATH_ORDER,
  				1 INDENTATION,
		       	A1.*
       	FROM 	IKEP4_BD_BOARD  A1
		WHERE	BOARD_ROOT_ID = #boardRootId# 
			AND PORTAL_Id = #portalId#
			AND	BOARD_DELETE = 0
	    	AND	BOARD_PARENT_ID is null
	    	AND MOBILE_USE = 1
	    UNION ALL
	    SELECT	CONVERT(NVARCHAR, CTE.PATH_ORDER + '/' + CONVERT(VARCHAR, A2.SORT_ORDER+1000)) PATH_ORDER,
	    		INDENTATION + 1,
		       	A2.*
		FROM	IKEP4_BD_BOARD A2, CTE
		WHERE	A2.BOARD_ROOT_ID = #boardRootId# 
			AND	A2.BOARD_DELETE = 0
			AND A2.MOBILE_USE = 1
			AND	CTE.BOARD_ID = A2.BOARD_PARENT_ID 
  	)
	SELECT INDENTATION,
	       (SELECT	COUNT(*) FROM IKEP4_BD_BOARD B WHERE CTE.BOARD_ID = B.BOARD_PARENT_ID AND B.BOARD_DELETE = 0) AS HAS_CHILDREN,
	       <include refid="lightpack.board.dao.board.sqlColumnList"/>
	FROM CTE
	<![CDATA[
    ORDER BY PATH_ORDER 
    ]]>  
  </select>
  
  <select id="listByBoardRootIdPer" parameterClass="map" resultMap="boardIndentationResult"> 
	  	/* [Board_SqlMap.xml] lightpack.board.dao.board.listByBoardRootId */		
  	WITH CTE AS (
  		SELECT 	CONVERT(NVARCHAR, '/' + CONVERT(VARCHAR, SORT_ORDER+1000)) PATH_ORDER,
  				1 INDENTATION,
		       	A1.*
       	FROM 	IKEP4_BD_BOARD  A1 inner join 
			 IKEP4_VW_PERMIT_SYS_RESOURCE B on A1.BOARD_ID  = B.RESOURCE_NAME
		WHERE	BOARD_ROOT_ID = #boardRootId# 
			AND PORTAL_Id = #portalId#
			AND	BOARD_DELETE = 0
	    	AND	BOARD_PARENT_ID is null
	    	AND B.OPERATION_NAME IN ('READ')
	    	AND B.CLASS_NAME='BBS-Board'
	    	AND B.USER_ID IN (#userId#, 'OPEN')	     
	    UNION ALL
	    SELECT	CONVERT(NVARCHAR, CTE.PATH_ORDER + '/' + CONVERT(VARCHAR, A2.SORT_ORDER+1000)) PATH_ORDER,
	    		INDENTATION + 1,
		       	A2.*
		FROM	IKEP4_BD_BOARD A2 
			    ,CTE
			    ,IKEP4_VW_PERMIT_SYS_RESOURCE B
		WHERE	A2.BOARD_ROOT_ID = #boardRootId# 
			AND	A2.BOARD_DELETE = 0
			AND A2.BOARD_ID  = B.RESOURCE_NAME
			AND B.OPERATION_NAME IN ('READ')
	    	AND B.CLASS_NAME='BBS-Board'
	    	AND B.USER_ID IN (#userId#, 'OPEN')	     
			AND	CTE.BOARD_ID = A2.BOARD_PARENT_ID 
  	)
	SELECT INDENTATION,
	       (SELECT	COUNT(*) FROM IKEP4_BD_BOARD B WHERE CTE.BOARD_ID = B.BOARD_PARENT_ID AND B.BOARD_DELETE = 0) AS HAS_CHILDREN,
	       <include refid="lightpack.board.dao.board.sqlColumnList"/>
	FROM CTE
	 <![CDATA[
  	 WHERE BOARD_TYPE <> '0'
	]]>
	ORDER BY PATH_ORDER
  </select>
  
  <select id="listByBoardRootIdPerMobile" parameterClass="map" resultMap="boardIndentationResult"> 
	/* [Board_SqlMap.xml] lightpack.board.dao.board.listByBoardRootId */		
  	WITH CTE AS (
  		SELECT 	CONVERT(NVARCHAR, '/' + CONVERT(VARCHAR, SORT_ORDER+1000)) PATH_ORDER,
  				1 INDENTATION,
		       	A1.*
       	FROM 	IKEP4_BD_BOARD  A1 inner join 
			 IKEP4_VW_PERMIT_SYS_RESOURCE B on A1.BOARD_ID  = B.RESOURCE_NAME
		WHERE	BOARD_ROOT_ID = #boardRootId# 
			AND PORTAL_Id = #portalId#
			AND	BOARD_DELETE = 0
	    	AND	BOARD_PARENT_ID is null
	    	AND B.OPERATION_NAME IN ('READ')
	    	AND B.CLASS_NAME='BBS-Board'
	    	AND B.USER_ID IN (#userId#, 'OPEN')	     
	    UNION ALL
	    SELECT	CONVERT(NVARCHAR, CTE.PATH_ORDER + '/' + CONVERT(VARCHAR, A2.SORT_ORDER+1000)) PATH_ORDER,
	    		INDENTATION + 1,
		       	A2.*
		FROM	IKEP4_BD_BOARD A2 
			    ,CTE
			    ,IKEP4_VW_PERMIT_SYS_RESOURCE B
		WHERE	A2.BOARD_ROOT_ID = #boardRootId# 
			AND	A2.BOARD_DELETE = 0
			AND A2.BOARD_ID  = B.RESOURCE_NAME
			AND B.OPERATION_NAME IN ('READ')
	    	AND B.CLASS_NAME='BBS-Board'
	    	AND B.USER_ID IN (#userId#, 'OPEN')	     
			AND	CTE.BOARD_ID = A2.BOARD_PARENT_ID 
  	)
	SELECT INDENTATION,
	       (SELECT	COUNT(*) FROM IKEP4_BD_BOARD B WHERE CTE.BOARD_ID = B.BOARD_PARENT_ID AND B.BOARD_DELETE = 0) AS HAS_CHILDREN,
	       BOARD_ID,  BOARD_PARENT_ID,  SORT_ORDER, 
		    BOARD_NAME,    BOARD_ROOT_ID,    BOARD_DESCRIPTION, 
		    BOARD_TYPE,    URL,    LIST_TYPE, 
		    ANONYMOUS,   RSS,    FILE_SIZE, 
		    IMAGE_FILE_SIZE,    IMAGE_WIDTH,    PAGE_NUM, 
		    DOC_POPUP,    REPLY,    LINEREPLY, 
		    RESTRICTION_TYPE,    READ_PERMISSION,    WRITE_PERMISSION, ADMIN_PERMISSION,  		   
		    BOARD_POPUP,       FILE_ATTACH_OPTION,   ALLOW_TYPE,        
		    PORTAL_ID,    PORTLET,   BOARD_DELETE,
		    REGISTER_ID,    REGISTER_NAME,    REGIST_DATE, 
		    UPDATER_ID,    UPDATER_NAME,   CTE. UPDATE_DATE,
		    BOARD_ENGLISH_NAME,    BOARD_ENGLISH_DESCRIPTION,   MOVE,
		    WORD_HEAD,    CONTENTS_READ_PERMISSION,   CONTENTS_READ_MAIL,
		    MOBILE_USE,    MOBILE_WRITE_USE, COLOR_USE
	FROM CTE
	INNER JOIN (SELECT * FROM IKEP4_CO_MENULIST_MOBILE WHERE USER_ID=#userId# and type='BOARD') Aa ON CTE.board_id = Aa.ITEM_ID
	<!--  <![CDATA[
  	 WHERE BOARD_TYPE <> '2'
	]]> -->
	ORDER BY PATH_ORDER
  </select>
  
  <select id="getBoardMenuList" resultMap="boardMenuResult"> 
    /* [Board_SqlMap.xml] lightpack.board.dao.board.listByBoardRootId */		
  	SELECT 
		ROW_NUMBER() OVER(ORDER BY BOARD_PARENT_ID) AS NUM,
	    BOARD_ID,
	    BOARD_NAME,
	    TYPE = 'BOARD'
	FROM  IKEP4_BD_BOARD 
	WHERE  BOARD_TYPE != 2
	AND		  BOARD_DELETE = 0
  </select>
</sqlMap>