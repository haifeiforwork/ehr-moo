<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd" >

<sqlMap namespace="com.lgcns.ikep4.approval.admin.dao.ApprStat" >

	<typeAlias alias="apprStat" type="com.lgcns.ikep4.approval.admin.model.ApprStat"/>
	<typeAlias alias="apprListSearchCondition"	type="com.lgcns.ikep4.approval.work.search.ApprListSearchCondition"/>
	
	
	<select id="getTimeStatList" parameterClass="apprListSearchCondition" resultClass="apprStat">
		SELECT /* [ApprStat_SqlMap.xml] getTimeStatList */ 
					  		
					  		<isEqual property="ymSize" compareValue="1">
								IFNULL(SUM(cnt1),0) cnt1, IFNULL(SUM(time1),0) time1,
								0 cnt2, 0 time2,
								0 cnt3, 0 time3,
								0 cnt4, 0 time4,
								0 cnt5, 0 time5,
								0 cnt6, 0 time6,
								0 cnt7, 0 time7,
								0 cnt8, 0 time8,
								0 cnt9, 0 time9,
								0 cnt10, 0 time10,
								0 cnt11, 0 time11,
								0 cnt12, 0 time12,
							</isEqual>
							<isEqual property="ymSize" compareValue="2">
								IFNULL(SUM(cnt1),0) cnt1, IFNULL(SUM(time1),0) time1,
								IFNULL(SUM(cnt2),0) cnt2, IFNULL(SUM(time2),0) time2,
								0 cnt3, 0 time3,
								0 cnt4, 0 time4,
								0 cnt5, 0 time5,
								0 cnt6, 0 time6,
								0 cnt7, 0 time7,
								0 cnt8, 0 time8,
								0 cnt9, 0 time9,
								0 cnt10, 0 time10,
								0 cnt11, 0 time11,
								0 cnt12, 0 time12,
							</isEqual>
							<isEqual property="ymSize" compareValue="3">
								IFNULL(SUM(cnt1),0) cnt1, IFNULL(SUM(time1),0) time1,
								IFNULL(SUM(cnt2),0) cnt2, IFNULL(SUM(time2),0) time2,
								IFNULL(SUM(cnt3),0) cnt3, IFNULL(SUM(time3),0) time3,
								0 cnt4, 0 time4,
								0 cnt5, 0 time5,
								0 cnt6, 0 time6,
								0 cnt7, 0 time7,
								0 cnt8, 0 time8,
								0 cnt9, 0 time9,
								0 cnt10, 0 time10,
								0 cnt11, 0 time11,
								0 cnt12, 0 time12,
							</isEqual>
							<isEqual property="ymSize" compareValue="4">
								IFNULL(SUM(cnt1),0) cnt1, IFNULL(SUM(time1),0) time1,
								IFNULL(SUM(cnt2),0) cnt2, IFNULL(SUM(time2),0) time2,
								IFNULL(SUM(cnt3),0) cnt3, IFNULL(SUM(time3),0) time3,
								IFNULL(SUM(cnt4),0) cnt4, IFNULL(SUM(time4),0) time4,
								0 cnt5, 0 time5,
								0 cnt6, 0 time6,
								0 cnt7, 0 time7,
								0 cnt8, 0 time8,
								0 cnt9, 0 time9,
								0 cnt10, 0 time10,
								0 cnt11, 0 time11,
								0 cnt12, 0 time12,
							</isEqual>
							<isEqual property="ymSize" compareValue="5">
								IFNULL(SUM(cnt1),0) cnt1, IFNULL(SUM(time1),0) time1,
								IFNULL(SUM(cnt2),0) cnt2, IFNULL(SUM(time2),0) time2,
								IFNULL(SUM(cnt3),0) cnt3, IFNULL(SUM(time3),0) time3,
								IFNULL(SUM(cnt4),0) cnt4, IFNULL(SUM(time4),0) time4,
								IFNULL(SUM(cnt5),0) cnt5, IFNULL(SUM(time5),0) time5,
								0 cnt6, 0 time6,
								0 cnt7, 0 time7,
								0 cnt8, 0 time8,
								0 cnt9, 0 time9,
								0 cnt10, 0 time10,
								0 cnt11, 0 time11,
								0 cnt12, 0 time12,
							</isEqual>
							<isEqual property="ymSize" compareValue="6">
								IFNULL(SUM(cnt1),0) cnt1, IFNULL(SUM(time1),0) time1,
								IFNULL(SUM(cnt2),0) cnt2, IFNULL(SUM(time2),0) time2,
								IFNULL(SUM(cnt3),0) cnt3, IFNULL(SUM(time3),0) time3,
								IFNULL(SUM(cnt4),0) cnt4, IFNULL(SUM(time4),0) time4,
								IFNULL(SUM(cnt5),0) cnt5, IFNULL(SUM(time5),0) time5,
								IFNULL(SUM(cnt6),0) cnt6, IFNULL(SUM(time6),0) time6,
								0 cnt7, 0 time7,
								0 cnt8, 0 time8,
								0 cnt9, 0 time9,
								0 cnt10, 0 time10,
								0 cnt11, 0 time11,
								0 cnt12, 0 time12,
							</isEqual>
							<isEqual property="ymSize" compareValue="7">
								IFNULL(SUM(cnt1),0) cnt1, IFNULL(SUM(time1),0) time1,
								IFNULL(SUM(cnt2),0) cnt2, IFNULL(SUM(time2),0) time2,
								IFNULL(SUM(cnt3),0) cnt3, IFNULL(SUM(time3),0) time3,
								IFNULL(SUM(cnt4),0) cnt4, IFNULL(SUM(time4),0) time4,
								IFNULL(SUM(cnt5),0) cnt5, IFNULL(SUM(time5),0) time5,
								IFNULL(SUM(cnt6),0) cnt6, IFNULL(SUM(time6),0) time6,
								IFNULL(SUM(cnt7),0) cnt7, IFNULL(SUM(time7),0) time7,
								0 cnt8, 0 time8,
								0 cnt9, 0 time9,
								0 cnt10, 0 time10,
								0 cnt11, 0 time11,
								0 cnt12, 0 time12,
							</isEqual>
							<isEqual property="ymSize" compareValue="8">
								IFNULL(SUM(cnt1),0) cnt1, IFNULL(SUM(time1),0) time1,
								IFNULL(SUM(cnt2),0) cnt2, IFNULL(SUM(time2),0) time2,
								IFNULL(SUM(cnt3),0) cnt3, IFNULL(SUM(time3),0) time3,
								IFNULL(SUM(cnt4),0) cnt4, IFNULL(SUM(time4),0) time4,
								IFNULL(SUM(cnt5),0) cnt5, IFNULL(SUM(time5),0) time5,
								IFNULL(SUM(cnt6),0) cnt6, IFNULL(SUM(time6),0) time6,
								IFNULL(SUM(cnt7),0) cnt7, IFNULL(SUM(time7),0) time7,
								IFNULL(SUM(cnt8),0) cnt8, IFNULL(SUM(time8),0) time8,
								0 cnt9, 0 time9,
								0 cnt10, 0 time10,
								0 cnt11, 0 time11,
								0 cnt12, 0 time12,
							</isEqual>
							<isEqual property="ymSize" compareValue="9">
								IFNULL(SUM(cnt1),0) cnt1, IFNULL(SUM(time1),0) time1,
								IFNULL(SUM(cnt2),0) cnt2, IFNULL(SUM(time2),0) time2,
								IFNULL(SUM(cnt3),0) cnt3, IFNULL(SUM(time3),0) time3,
								IFNULL(SUM(cnt4),0) cnt4, IFNULL(SUM(time4),0) time4,
								IFNULL(SUM(cnt5),0) cnt5, IFNULL(SUM(time5),0) time5,
								IFNULL(SUM(cnt6),0) cnt6, IFNULL(SUM(time6),0) time6,
								IFNULL(SUM(cnt7),0) cnt7, IFNULL(SUM(time7),0) time7,
								IFNULL(SUM(cnt8),0) cnt8, IFNULL(SUM(time8),0) time8,
								IFNULL(SUM(cnt9),0) cnt9, IFNULL(SUM(time9),0) time9,
								0 cnt10, 0 time10,
								0 cnt11, 0 time11,
								0 cnt12, 0 time12,
							</isEqual>
							<isEqual property="ymSize" compareValue="10">
								IFNULL(SUM(cnt1),0) cnt1, IFNULL(SUM(time1),0) time1,
								IFNULL(SUM(cnt2),0) cnt2, IFNULL(SUM(time2),0) time2,
								IFNULL(SUM(cnt3),0) cnt3, IFNULL(SUM(time3),0) time3,
								IFNULL(SUM(cnt4),0) cnt4, IFNULL(SUM(time4),0) time4,
								IFNULL(SUM(cnt5),0) cnt5, IFNULL(SUM(time5),0) time5,
								IFNULL(SUM(cnt6),0) cnt6, IFNULL(SUM(time6),0) time6,
								IFNULL(SUM(cnt7),0) cnt7, IFNULL(SUM(time7),0) time7,
								IFNULL(SUM(cnt8),0) cnt8, IFNULL(SUM(time8),0) time8,
								IFNULL(SUM(cnt9),0) cnt9, IFNULL(SUM(time9),0) time9,
								IFNULL(SUM(cnt10),0) cnt10, IFNULL(SUM(time10),0) time10,
								0 cnt11, 0 time11,
								0 cnt12, 0 time12,
							</isEqual>
							<isEqual property="ymSize" compareValue="11">
								IFNULL(SUM(cnt1),0) cnt1, IFNULL(SUM(time1),0) time1,
								IFNULL(SUM(cnt2),0) cnt2, IFNULL(SUM(time2),0) time2,
								IFNULL(SUM(cnt3),0) cnt3, IFNULL(SUM(time3),0) time3,
								IFNULL(SUM(cnt4),0) cnt4, IFNULL(SUM(time4),0) time4,
								IFNULL(SUM(cnt5),0) cnt5, IFNULL(SUM(time5),0) time5,
								IFNULL(SUM(cnt6),0) cnt6, IFNULL(SUM(time6),0) time6,
								IFNULL(SUM(cnt7),0) cnt7, IFNULL(SUM(time7),0) time7,
								IFNULL(SUM(cnt8),0) cnt8, IFNULL(SUM(time8),0) time8,
								IFNULL(SUM(cnt9),0) cnt9, IFNULL(SUM(time9),0) time9,
								IFNULL(SUM(cnt10),0) cnt10, IFNULL(SUM(time10),0) time10,
								IFNULL(SUM(cnt11),0) cnt11, IFNULL(SUM(time11),0) time11,
								0 cnt12, 0 time12,
							</isEqual>
							<isEqual property="ymSize" compareValue="12">
								IFNULL(SUM(cnt1),0) cnt1, IFNULL(SUM(time1),0) time1,
								IFNULL(SUM(cnt2),0) cnt2, IFNULL(SUM(time2),0) time2,
								IFNULL(SUM(cnt3),0) cnt3, IFNULL(SUM(time3),0) time3,
								IFNULL(SUM(cnt4),0) cnt4, IFNULL(SUM(time4),0) time4,
								IFNULL(SUM(cnt5),0) cnt5, IFNULL(SUM(time5),0) time5,
								IFNULL(SUM(cnt6),0) cnt6, IFNULL(SUM(time6),0) time6,
								IFNULL(SUM(cnt7),0) cnt7, IFNULL(SUM(time7),0) time7,
								IFNULL(SUM(cnt8),0) cnt8, IFNULL(SUM(time8),0) time8,
								IFNULL(SUM(cnt9),0) cnt9, IFNULL(SUM(time9),0) time9,
								IFNULL(SUM(cnt10),0) cnt10, IFNULL(SUM(time10),0) time10,
								IFNULL(SUM(cnt11),0) cnt11, IFNULL(SUM(time11),0) time11,
								IFNULL(SUM(cnt12),0) cnt12, IFNULL(SUM(time12),0) time12,
							</isEqual>
							
					         IFNULL(SUM(cntSum),0) cntSum,
					         IFNULL(SUM(timeSum),0) timeSum,
					         b.GROUP_ID groupId,
	         				 b.GROUP_NAME groupName
						    FROM (  SELECT <isNotEmpty property="ym1">
						                   		CASE WHEN DATE_FORMAT(stats_date, '%Y-%m') =  #ym1# THEN SUM(doc_cnt) END cnt1,
						                   		CASE WHEN DATE_FORMAT(stats_date, '%Y-%m') =  #ym1# THEN SUM(doc_lead_time) END time1,
						                   </isNotEmpty>
						                   <isNotEmpty property="ym2">
						                   		CASE WHEN DATE_FORMAT(stats_date, '%Y-%m') =  #ym2# THEN SUM(doc_cnt) END cnt2,
						                   		CASE WHEN DATE_FORMAT(stats_date, '%Y-%m') =  #ym2# THEN SUM(doc_lead_time) END time2,
						                   </isNotEmpty>
						                   <isNotEmpty property="ym3">
						                   		CASE WHEN DATE_FORMAT(stats_date, '%Y-%m') =  #ym3# THEN SUM(doc_cnt) END cnt3,
						                   		CASE WHEN DATE_FORMAT(stats_date, '%Y-%m') =  #ym3# THEN SUM(doc_lead_time) END time3,
						                   </isNotEmpty>
						                   <isNotEmpty property="ym4">
						                   		CASE WHEN DATE_FORMAT(stats_date, '%Y-%m') =  #ym4# THEN SUM(doc_cnt) END cnt4,
						                   		CASE WHEN DATE_FORMAT(stats_date, '%Y-%m') =  #ym4# THEN SUM(doc_lead_time) END time4,
						                   </isNotEmpty>
						                   <isNotEmpty property="ym5">
						                   		CASE WHEN DATE_FORMAT(stats_date, '%Y-%m') =  #ym5# THEN SUM(doc_cnt) END cnt5,
						                   		CASE WHEN DATE_FORMAT(stats_date, '%Y-%m') =  #ym5# THEN SUM(doc_lead_time) END time5,
						                   </isNotEmpty>
						                   <isNotEmpty property="ym6">
						                   		CASE WHEN DATE_FORMAT(stats_date, '%Y-%m') =  #ym6# THEN SUM(doc_cnt) END cnt6,
						                   		CASE WHEN DATE_FORMAT(stats_date, '%Y-%m') =  #ym6# THEN SUM(doc_lead_time) END time6,
						                   </isNotEmpty>
						                   <isNotEmpty property="ym7">
						                   		CASE WHEN DATE_FORMAT(stats_date, '%Y-%m') =  #ym7# THEN SUM(doc_cnt) END cnt7,
						                   		CASE WHEN DATE_FORMAT(stats_date, '%Y-%m') =  #ym7# THEN SUM(doc_lead_time) END time7,
						                   </isNotEmpty>
						                   <isNotEmpty property="ym8">
						                   		CASE WHEN DATE_FORMAT(stats_date, '%Y-%m') =  #ym8# THEN SUM(doc_cnt) END cnt8,
						                   		CASE WHEN DATE_FORMAT(stats_date, '%Y-%m') =  #ym8# THEN SUM(doc_lead_time) END time8,
						                   </isNotEmpty>
						                   <isNotEmpty property="ym9">
						                   		CASE WHEN DATE_FORMAT(stats_date, '%Y-%m') =  #ym9# THEN SUM(doc_cnt) END cnt9,
						                   		CASE WHEN DATE_FORMAT(stats_date, '%Y-%m') =  #ym9# THEN SUM(doc_lead_time) END time9,
						                   </isNotEmpty>
						                   <isNotEmpty property="ym10">
						                   		CASE WHEN DATE_FORMAT(stats_date, '%Y-%m') =  #ym10# THEN SUM(doc_cnt) END cnt10,
						                   		CASE WHEN DATE_FORMAT(stats_date, '%Y-%m') =  #ym10# THEN SUM(doc_lead_time) END time10,
						                   </isNotEmpty>
						                   <isNotEmpty property="ym11">
						                   		CASE WHEN DATE_FORMAT(stats_date, '%Y-%m') =  #ym11# THEN SUM(doc_cnt) END cnt11,
						                   		CASE WHEN DATE_FORMAT(stats_date, '%Y-%m') =  #ym11# THEN SUM(doc_lead_time) END time11,
						                   </isNotEmpty>
						                   <isNotEmpty property="ym12">
						                   		CASE WHEN DATE_FORMAT(stats_date, '%Y-%m') =  #ym12# THEN SUM(doc_cnt) END cnt12,
						                   		CASE WHEN DATE_FORMAT(stats_date, '%Y-%m') =  #ym12# THEN SUM(doc_lead_time) END time12,
						                   </isNotEmpty>
						                   SUM(doc_cnt) cntSum,
						                   SUM(doc_lead_time) timeSum,
						                   group_id
						              FROM IKEP4_APPR_DOC_STATS
				              			WHERE stats_date BETWEEN STR_TO_DATE(#searchStartDate#,'%Y-%m-%d') AND STR_TO_DATE(#searchEndDate#,'%Y-%m-%d')
				              
						              <isNotEmpty property="searchGroupId">
											AND	parent_group_id = #searchGroupId#
										</isNotEmpty>

							          GROUP BY group_id, group_name, DATE_FORMAT(stats_date, '%Y-%m')) aa
							         RIGHT JOIN
							            ikep4_ev_group b
							         ON aa.GROUP_ID = b.GROUP_ID
							   WHERE b.parent_group_id = #searchGroupId# AND b.group_type_id = 'G0001'
					GROUP BY b.GROUP_ID,  b.GROUP_NAME
					 
					ORDER BY
					<isNotEmpty property="sortColumn">
						<isEqual property="sortColumn" compareValue="groupName">
				    		b.group_name
						</isEqual>
						<isEqual property="sortColumn" compareValue="cntSum">
				    		cntSum
						</isEqual>
						<isEqual property="sortColumn" compareValue="timeSum">
				    		timeSum
						</isEqual>
					</isNotEmpty>
			    	<isNotEmpty property="sortType">
				    	<isEqual property="sortType" compareValue="DESC">
				    		DESC
						</isEqual>
						<isEqual property="sortType" compareValue="ASC">
				    		ASC
						</isEqual>
					</isNotEmpty>
	</select>
	
	
	<select id="getUserStatList" parameterClass="apprListSearchCondition" resultClass="apprStat">
		SELECT /* [ApprStat_SqlMap.xml] getUserStatList */ 
					  			<isEqual property="ymSize" compareValue="1">
									IFNULL(SUM(cnt1),0) cnt1, IFNULL(SUM(time1),0) time1,
									0 cnt2, 0 time2,
									0 cnt3, 0 time3,
									0 cnt4, 0 time4,
									0 cnt5, 0 time5,
									0 cnt6, 0 time6,
									0 cnt7, 0 time7,
									0 cnt8, 0 time8,
									0 cnt9, 0 time9,
									0 cnt10, 0 time10,
									0 cnt11, 0 time11,
									0 cnt12, 0 time12,
								</isEqual>
								<isEqual property="ymSize" compareValue="2">
									IFNULL(SUM(cnt1),0) cnt1, IFNULL(SUM(time1),0) time1,
									IFNULL(SUM(cnt2),0) cnt2, IFNULL(SUM(time2),0) time2,
									0 cnt3, 0 time3,
									0 cnt4, 0 time4,
									0 cnt5, 0 time5,
									0 cnt6, 0 time6,
									0 cnt7, 0 time7,
									0 cnt8, 0 time8,
									0 cnt9, 0 time9,
									0 cnt10, 0 time10,
									0 cnt11, 0 time11,
									0 cnt12, 0 time12,
								</isEqual>
								<isEqual property="ymSize" compareValue="3">
									IFNULL(SUM(cnt1),0) cnt1, IFNULL(SUM(time1),0) time1,
									IFNULL(SUM(cnt2),0) cnt2, IFNULL(SUM(time2),0) time2,
									IFNULL(SUM(cnt3),0) cnt3, IFNULL(SUM(time3),0) time3,
									0 cnt4, 0 time4,
									0 cnt5, 0 time5,
									0 cnt6, 0 time6,
									0 cnt7, 0 time7,
									0 cnt8, 0 time8,
									0 cnt9, 0 time9,
									0 cnt10, 0 time10,
									0 cnt11, 0 time11,
									0 cnt12, 0 time12,
								</isEqual>
								<isEqual property="ymSize" compareValue="4">
									IFNULL(SUM(cnt1),0) cnt1, IFNULL(SUM(time1),0) time1,
									IFNULL(SUM(cnt2),0) cnt2, IFNULL(SUM(time2),0) time2,
									IFNULL(SUM(cnt3),0) cnt3, IFNULL(SUM(time3),0) time3,
									IFNULL(SUM(cnt4),0) cnt4, IFNULL(SUM(time4),0) time4,
									0 cnt5, 0 time5,
									0 cnt6, 0 time6,
									0 cnt7, 0 time7,
									0 cnt8, 0 time8,
									0 cnt9, 0 time9,
									0 cnt10, 0 time10,
									0 cnt11, 0 time11,
									0 cnt12, 0 time12,
								</isEqual>
								<isEqual property="ymSize" compareValue="5">
									IFNULL(SUM(cnt1),0) cnt1, IFNULL(SUM(time1),0) time1,
									IFNULL(SUM(cnt2),0) cnt2, IFNULL(SUM(time2),0) time2,
									IFNULL(SUM(cnt3),0) cnt3, IFNULL(SUM(time3),0) time3,
									IFNULL(SUM(cnt4),0) cnt4, IFNULL(SUM(time4),0) time4,
									IFNULL(SUM(cnt5),0) cnt5, IFNULL(SUM(time5),0) time5,
									0 cnt6, 0 time6,
									0 cnt7, 0 time7,
									0 cnt8, 0 time8,
									0 cnt9, 0 time9,
									0 cnt10, 0 time10,
									0 cnt11, 0 time11,
									0 cnt12, 0 time12,
								</isEqual>
								<isEqual property="ymSize" compareValue="6">
									IFNULL(SUM(cnt1),0) cnt1, IFNULL(SUM(time1),0) time1,
									IFNULL(SUM(cnt2),0) cnt2, IFNULL(SUM(time2),0) time2,
									IFNULL(SUM(cnt3),0) cnt3, IFNULL(SUM(time3),0) time3,
									IFNULL(SUM(cnt4),0) cnt4, IFNULL(SUM(time4),0) time4,
									IFNULL(SUM(cnt5),0) cnt5, IFNULL(SUM(time5),0) time5,
									IFNULL(SUM(cnt6),0) cnt6, IFNULL(SUM(time6),0) time6,
									0 cnt7, 0 time7,
									0 cnt8, 0 time8,
									0 cnt9, 0 time9,
									0 cnt10, 0 time10,
									0 cnt11, 0 time11,
									0 cnt12, 0 time12,
								</isEqual>
								<isEqual property="ymSize" compareValue="7">
									IFNULL(SUM(cnt1),0) cnt1, IFNULL(SUM(time1),0) time1,
									IFNULL(SUM(cnt2),0) cnt2, IFNULL(SUM(time2),0) time2,
									IFNULL(SUM(cnt3),0) cnt3, IFNULL(SUM(time3),0) time3,
									IFNULL(SUM(cnt4),0) cnt4, IFNULL(SUM(time4),0) time4,
									IFNULL(SUM(cnt5),0) cnt5, IFNULL(SUM(time5),0) time5,
									IFNULL(SUM(cnt6),0) cnt6, IFNULL(SUM(time6),0) time6,
									IFNULL(SUM(cnt7),0) cnt7, IFNULL(SUM(time7),0) time7,
									0 cnt8, 0 time8,
									0 cnt9, 0 time9,
									0 cnt10, 0 time10,
									0 cnt11, 0 time11,
									0 cnt12, 0 time12,
								</isEqual>
								<isEqual property="ymSize" compareValue="8">
									IFNULL(SUM(cnt1),0) cnt1, IFNULL(SUM(time1),0) time1,
									IFNULL(SUM(cnt2),0) cnt2, IFNULL(SUM(time2),0) time2,
									IFNULL(SUM(cnt3),0) cnt3, IFNULL(SUM(time3),0) time3,
									IFNULL(SUM(cnt4),0) cnt4, IFNULL(SUM(time4),0) time4,
									IFNULL(SUM(cnt5),0) cnt5, IFNULL(SUM(time5),0) time5,
									IFNULL(SUM(cnt6),0) cnt6, IFNULL(SUM(time6),0) time6,
									IFNULL(SUM(cnt7),0) cnt7, IFNULL(SUM(time7),0) time7,
									IFNULL(SUM(cnt8),0) cnt8, IFNULL(SUM(time8),0) time8,
									0 cnt9, 0 time9,
									0 cnt10, 0 time10,
									0 cnt11, 0 time11,
									0 cnt12, 0 time12,
								</isEqual>
								<isEqual property="ymSize" compareValue="9">
									IFNULL(SUM(cnt1),0) cnt1, IFNULL(SUM(time1),0) time1,
									IFNULL(SUM(cnt2),0) cnt2, IFNULL(SUM(time2),0) time2,
									IFNULL(SUM(cnt3),0) cnt3, IFNULL(SUM(time3),0) time3,
									IFNULL(SUM(cnt4),0) cnt4, IFNULL(SUM(time4),0) time4,
									IFNULL(SUM(cnt5),0) cnt5, IFNULL(SUM(time5),0) time5,
									IFNULL(SUM(cnt6),0) cnt6, IFNULL(SUM(time6),0) time6,
									IFNULL(SUM(cnt7),0) cnt7, IFNULL(SUM(time7),0) time7,
									IFNULL(SUM(cnt8),0) cnt8, IFNULL(SUM(time8),0) time8,
									IFNULL(SUM(cnt9),0) cnt9, IFNULL(SUM(time9),0) time9,
									0 cnt10, 0 time10,
									0 cnt11, 0 time11,
									0 cnt12, 0 time12,
								</isEqual>
								<isEqual property="ymSize" compareValue="10">
									IFNULL(SUM(cnt1),0) cnt1, IFNULL(SUM(time1),0) time1,
									IFNULL(SUM(cnt2),0) cnt2, IFNULL(SUM(time2),0) time2,
									IFNULL(SUM(cnt3),0) cnt3, IFNULL(SUM(time3),0) time3,
									IFNULL(SUM(cnt4),0) cnt4, IFNULL(SUM(time4),0) time4,
									IFNULL(SUM(cnt5),0) cnt5, IFNULL(SUM(time5),0) time5,
									IFNULL(SUM(cnt6),0) cnt6, IFNULL(SUM(time6),0) time6,
									IFNULL(SUM(cnt7),0) cnt7, IFNULL(SUM(time7),0) time7,
									IFNULL(SUM(cnt8),0) cnt8, IFNULL(SUM(time8),0) time8,
									IFNULL(SUM(cnt9),0) cnt9, IFNULL(SUM(time9),0) time9,
									IFNULL(SUM(cnt10),0) cnt10, IFNULL(SUM(time10),0) time10,
									0 cnt11, 0 time11,
									0 cnt12, 0 time12,
								</isEqual>
								<isEqual property="ymSize" compareValue="11">
									IFNULL(SUM(cnt1),0) cnt1, IFNULL(SUM(time1),0) time1,
									IFNULL(SUM(cnt2),0) cnt2, IFNULL(SUM(time2),0) time2,
									IFNULL(SUM(cnt3),0) cnt3, IFNULL(SUM(time3),0) time3,
									IFNULL(SUM(cnt4),0) cnt4, IFNULL(SUM(time4),0) time4,
									IFNULL(SUM(cnt5),0) cnt5, IFNULL(SUM(time5),0) time5,
									IFNULL(SUM(cnt6),0) cnt6, IFNULL(SUM(time6),0) time6,
									IFNULL(SUM(cnt7),0) cnt7, IFNULL(SUM(time7),0) time7,
									IFNULL(SUM(cnt8),0) cnt8, IFNULL(SUM(time8),0) time8,
									IFNULL(SUM(cnt9),0) cnt9, IFNULL(SUM(time9),0) time9,
									IFNULL(SUM(cnt10),0) cnt10, IFNULL(SUM(time10),0) time10,
									IFNULL(SUM(cnt11),0) cnt11, IFNULL(SUM(time11),0) time11,
									0 cnt12, 0 time12,
								</isEqual>
								<isEqual property="ymSize" compareValue="12">
									IFNULL(SUM(cnt1),0) cnt1, IFNULL(SUM(time1),0) time1,
									IFNULL(SUM(cnt2),0) cnt2, IFNULL(SUM(time2),0) time2,
									IFNULL(SUM(cnt3),0) cnt3, IFNULL(SUM(time3),0) time3,
									IFNULL(SUM(cnt4),0) cnt4, IFNULL(SUM(time4),0) time4,
									IFNULL(SUM(cnt5),0) cnt5, IFNULL(SUM(time5),0) time5,
									IFNULL(SUM(cnt6),0) cnt6, IFNULL(SUM(time6),0) time6,
									IFNULL(SUM(cnt7),0) cnt7, IFNULL(SUM(time7),0) time7,
									IFNULL(SUM(cnt8),0) cnt8, IFNULL(SUM(time8),0) time8,
									IFNULL(SUM(cnt9),0) cnt9, IFNULL(SUM(time9),0) time9,
									IFNULL(SUM(cnt10),0) cnt10, IFNULL(SUM(time10),0) time10,
									IFNULL(SUM(cnt11),0) cnt11, IFNULL(SUM(time11),0) time11,
									IFNULL(SUM(cnt12),0) cnt12, IFNULL(SUM(time12),0) time12,
								</isEqual>
						
						         IFNULL(SUM(cntSum),0) cntSum,
						         IFNULL(SUM(timeSum),0) timeSum,
						         user_id approverId,
						         user_name approverName
						    FROM (  SELECT <isNotEmpty property="ym1">
						                   		CASE WHEN DATE_FORMAT(stats_date, '%Y-%m') =  #ym1# THEN SUM(doc_cnt) END cnt1,
						                   		CASE WHEN DATE_FORMAT(stats_date, '%Y-%m') =  #ym1# THEN SUM(doc_lead_time) END time1,
						                   </isNotEmpty>
						                   <isNotEmpty property="ym2">
						                   		CASE WHEN DATE_FORMAT(stats_date, '%Y-%m') =  #ym2# THEN SUM(doc_cnt) END cnt2,
						                   		CASE WHEN DATE_FORMAT(stats_date, '%Y-%m') =  #ym2# THEN SUM(doc_lead_time) END time2,
						                   </isNotEmpty>
						                   <isNotEmpty property="ym3">
						                   		CASE WHEN DATE_FORMAT(stats_date, '%Y-%m') =  #ym3# THEN SUM(doc_cnt) END cnt3,
						                   		CASE WHEN DATE_FORMAT(stats_date, '%Y-%m') =  #ym3# THEN SUM(doc_lead_time) END time3,
						                   </isNotEmpty>
						                   <isNotEmpty property="ym4">
						                   		CASE WHEN DATE_FORMAT(stats_date, '%Y-%m') =  #ym4# THEN SUM(doc_cnt) END cnt4,
						                   		CASE WHEN DATE_FORMAT(stats_date, '%Y-%m') =  #ym4# THEN SUM(doc_lead_time) END time4,
						                   </isNotEmpty>
						                   <isNotEmpty property="ym5">
						                   		CASE WHEN DATE_FORMAT(stats_date, '%Y-%m') =  #ym5# THEN SUM(doc_cnt) END cnt5,
						                   		CASE WHEN DATE_FORMAT(stats_date, '%Y-%m') =  #ym5# THEN SUM(doc_lead_time) END time5,
						                   </isNotEmpty>
						                   <isNotEmpty property="ym6">
						                   		CASE WHEN DATE_FORMAT(stats_date, '%Y-%m') =  #ym6# THEN SUM(doc_cnt) END cnt6,
						                   		CASE WHEN DATE_FORMAT(stats_date, '%Y-%m') =  #ym6# THEN SUM(doc_lead_time) END time6,
						                   </isNotEmpty>
						                   <isNotEmpty property="ym7">
						                   		CASE WHEN DATE_FORMAT(stats_date, '%Y-%m') =  #ym7# THEN SUM(doc_cnt) END cnt7,
						                   		CASE WHEN DATE_FORMAT(stats_date, '%Y-%m') =  #ym7# THEN SUM(doc_lead_time) END time7,
						                   </isNotEmpty>
						                   <isNotEmpty property="ym8">
						                   		CASE WHEN DATE_FORMAT(stats_date, '%Y-%m') =  #ym8# THEN SUM(doc_cnt) END cnt8,
						                   		CASE WHEN DATE_FORMAT(stats_date, '%Y-%m') =  #ym8# THEN SUM(doc_lead_time) END time8,
						                   </isNotEmpty>
						                   <isNotEmpty property="ym9">
						                   		CASE WHEN DATE_FORMAT(stats_date, '%Y-%m') =  #ym9# THEN SUM(doc_cnt) END cnt9,
						                   		CASE WHEN DATE_FORMAT(stats_date, '%Y-%m') =  #ym9# THEN SUM(doc_lead_time) END time9,
						                   </isNotEmpty>
						                   <isNotEmpty property="ym10">
						                   		CASE WHEN DATE_FORMAT(stats_date, '%Y-%m') =  #ym10# THEN SUM(doc_cnt) END cnt10,
						                   		CASE WHEN DATE_FORMAT(stats_date, '%Y-%m') =  #ym10# THEN SUM(doc_lead_time) END time10,
						                   </isNotEmpty>
						                   <isNotEmpty property="ym11">
						                   		CASE WHEN DATE_FORMAT(stats_date, '%Y-%m') =  #ym11# THEN SUM(doc_cnt) END cnt11,
						                   		CASE WHEN DATE_FORMAT(stats_date, '%Y-%m') =  #ym11# THEN SUM(doc_lead_time) END time11,
						                   </isNotEmpty>
						                   <isNotEmpty property="ym12">
						                   		CASE WHEN DATE_FORMAT(stats_date, '%Y-%m') =  #ym12# THEN SUM(doc_cnt) END cnt12,
						                   		CASE WHEN DATE_FORMAT(stats_date, '%Y-%m') =  #ym12# THEN SUM(doc_lead_time) END time12,
						                   </isNotEmpty>
						                   
						                   SUM(doc_cnt) cntSum,
						                   SUM(doc_lead_time) timeSum,
						                   user_id,
						                   user_name
						              FROM IKEP4_APPR_USER_STATS
						              WHERE stats_date BETWEEN STR_TO_DATE(#searchStartDate#,'%Y-%m-%d %T') AND STR_TO_DATE(#searchEndDate#,'%Y-%m-%d %T')
						              
						              <isNotEmpty property="searchApprTitle">
											AND	UPPER(user_name) LIKE '%' || UPPER(#searchApprTitle#) || '%'
										</isNotEmpty>

						          GROUP BY user_id, user_name, DATE_FORMAT(stats_date, '%Y-%m')) aa
						GROUP BY user_id, user_name
					 
					ORDER BY
					<isNotEmpty property="sortColumn">
						<isEqual property="sortColumn" compareValue="approverName">
				    		user_name
						</isEqual>
						<isEqual property="sortColumn" compareValue="cntSum">
				    		cntSum
						</isEqual>
						<isEqual property="sortColumn" compareValue="timeSum">
				    		timeSum
						</isEqual>
					</isNotEmpty>
			    	<isNotEmpty property="sortType">
				    	<isEqual property="sortType" compareValue="DESC">
				    		DESC
						</isEqual>
						<isEqual property="sortType" compareValue="ASC">
				    		ASC
						</isEqual>
					</isNotEmpty>
				 /* ===========================================END  */ 
		<![CDATA[  
		    LIMIT #startRowIndex#, #pagePerRecord#
		]]> 	
	</select>
	
	<select id="getUserStatCount" parameterClass="apprListSearchCondition" resultClass="int">
	
		  SELECT 	 /* [ApprStat_SqlMap.xml] getUserStatCount */
			count(*) 
				FROM (
						SELECT  user_id,
						        user_name
						    FROM (  SELECT user_id,
						                   user_name
						              FROM IKEP4_APPR_USER_STATS
						              WHERE stats_date BETWEEN STR_TO_DATE(#searchStartDate#,'%Y-%m-%d %T') AND STR_TO_DATE(#searchEndDate#,'%Y-%m-%d %T')
						              
						              <isNotEmpty property="searchApprTitle">
											AND	UPPER(user_name) LIKE '%' || UPPER(#searchApprTitle#) || '%'
										</isNotEmpty>
					
						          GROUP BY user_id, user_name, DATE_FORMAT(stats_date, '%Y-%m')) aa
						GROUP BY user_id, user_name) bb

	</select>
	
	<select id="getFormStatList" parameterClass="apprListSearchCondition" resultClass="apprStat">
		/* [ApprStat_SqlMap.xml] getFormStatList */ 
   		SELECT  <isEqual property="ymSize" compareValue="1">
					IFNULL(SUM(cnt1),0) cnt1, 
					0 cnt2, 
					0 cnt3, 
					0 cnt4, 
					0 cnt5, 
					0 cnt6, 
					0 cnt7, 
					0 cnt8, 
					0 cnt9, 
					0 cnt10, 
					0 cnt11, 
					0 cnt12, 
				</isEqual>
				<isEqual property="ymSize" compareValue="2">
					IFNULL(SUM(cnt1),0) cnt1, 
					IFNULL(SUM(cnt2),0) cnt2, 
					0 cnt3, 
					0 cnt4, 
					0 cnt5, 
					0 cnt6, 
					0 cnt7, 
					0 cnt8, 
					0 cnt9, 
					0 cnt10, 
					0 cnt11, 
					0 cnt12, 
				</isEqual>
				<isEqual property="ymSize" compareValue="3">
					IFNULL(SUM(cnt1),0) cnt1, 
					IFNULL(SUM(cnt2),0) cnt2, 
					IFNULL(SUM(cnt3),0) cnt3, 
					0 cnt4, 
					0 cnt5, 
					0 cnt6, 
					0 cnt7, 
					0 cnt8, 
					0 cnt9, 
					0 cnt10, 
					0 cnt11, 
					0 cnt12, 
				</isEqual>
				<isEqual property="ymSize" compareValue="4">
					IFNULL(SUM(cnt1),0) cnt1, 
					IFNULL(SUM(cnt2),0) cnt2, 
					IFNULL(SUM(cnt3),0) cnt3, 
					IFNULL(SUM(cnt4),0) cnt4, 
					0 cnt5, 
					0 cnt6, 
					0 cnt7, 
					0 cnt8, 
					0 cnt9, 
					0 cnt10, 
					0 cnt11, 
					0 cnt12, 
				</isEqual>
				<isEqual property="ymSize" compareValue="5">
					IFNULL(SUM(cnt1),0) cnt1, 
					IFNULL(SUM(cnt2),0) cnt2, 
					IFNULL(SUM(cnt3),0) cnt3, 
					IFNULL(SUM(cnt4),0) cnt4, 
					IFNULL(SUM(cnt5),0) cnt5, 
					0 cnt6, 
					0 cnt7, 
					0 cnt8, 
					0 cnt9, 
					0 cnt10, 
					0 cnt11, 
					0 cnt12, 
				</isEqual>
				<isEqual property="ymSize" compareValue="6">
					IFNULL(SUM(cnt1),0) cnt1, 
					IFNULL(SUM(cnt2),0) cnt2, 
					IFNULL(SUM(cnt3),0) cnt3, 
					IFNULL(SUM(cnt4),0) cnt4, 
					IFNULL(SUM(cnt5),0) cnt5, 
					IFNULL(SUM(cnt6),0) cnt6, 
					0 cnt7, 
					0 cnt8, 
					0 cnt9, 
					0 cnt10, 
					0 cnt11, 
					0 cnt12, 
				</isEqual>
				<isEqual property="ymSize" compareValue="7">
					IFNULL(SUM(cnt1),0) cnt1, 
					IFNULL(SUM(cnt2),0) cnt2, 
					IFNULL(SUM(cnt3),0) cnt3, 
					IFNULL(SUM(cnt4),0) cnt4, 
					IFNULL(SUM(cnt5),0) cnt5, 
					IFNULL(SUM(cnt6),0) cnt6, 
					IFNULL(SUM(cnt7),0) cnt7, 
					0 cnt8, 
					0 cnt9, 
					0 cnt10, 
					0 cnt11, 
					0 cnt12, 
				</isEqual>
				<isEqual property="ymSize" compareValue="8">
					IFNULL(SUM(cnt1),0) cnt1, 
					IFNULL(SUM(cnt2),0) cnt2, 
					IFNULL(SUM(cnt3),0) cnt3, 
					IFNULL(SUM(cnt4),0) cnt4, 
					IFNULL(SUM(cnt5),0) cnt5, 
					IFNULL(SUM(cnt6),0) cnt6, 
					IFNULL(SUM(cnt7),0) cnt7, 
					IFNULL(SUM(cnt8),0) cnt8, 
					0 cnt9, 
					0 cnt10, 
					0 cnt11, 
					0 cnt12, 
				</isEqual>
				<isEqual property="ymSize" compareValue="9">
					IFNULL(SUM(cnt1),0) cnt1, 
					IFNULL(SUM(cnt2),0) cnt2, 
					IFNULL(SUM(cnt3),0) cnt3, 
					IFNULL(SUM(cnt4),0) cnt4, 
					IFNULL(SUM(cnt5),0) cnt5, 
					IFNULL(SUM(cnt6),0) cnt6,
					IFNULL(SUM(cnt7),0) cnt7, 
					IFNULL(SUM(cnt8),0) cnt8, 
					IFNULL(SUM(cnt9),0) cnt9, 
					0 cnt10, 
					0 cnt11, 
					0 cnt12, 
				</isEqual>
				<isEqual property="ymSize" compareValue="10">
					IFNULL(SUM(cnt1),0) cnt1, 
					IFNULL(SUM(cnt2),0) cnt2, 
					IFNULL(SUM(cnt3),0) cnt3, 
					IFNULL(SUM(cnt4),0) cnt4, 
					IFNULL(SUM(cnt5),0) cnt5, 
					IFNULL(SUM(cnt6),0) cnt6, 
					IFNULL(SUM(cnt7),0) cnt7, 
					IFNULL(SUM(cnt8),0) cnt8, 
					IFNULL(SUM(cnt9),0) cnt9, 
					IFNULL(SUM(cnt10),0) cnt10, 
					0 cnt11, 
					0 cnt12, 
				</isEqual>
				<isEqual property="ymSize" compareValue="11">
					IFNULL(SUM(cnt1),0) cnt1, 
					IFNULL(SUM(cnt2),0) cnt2, 
					IFNULL(SUM(cnt3),0) cnt3, 
					IFNULL(SUM(cnt4),0) cnt4, 
					IFNULL(SUM(cnt5),0) cnt5, 
					IFNULL(SUM(cnt6),0) cnt6, 
					IFNULL(SUM(cnt7),0) cnt7, 
					IFNULL(SUM(cnt8),0) cnt8, 
					IFNULL(SUM(cnt9),0) cnt9, 
					IFNULL(SUM(cnt10),0) cnt10, 
					IFNULL(SUM(cnt11),0) cnt11, 
					0 cnt12, 
				</isEqual>
				<isEqual property="ymSize" compareValue="12">
					IFNULL(SUM(cnt1),0) cnt1, 
					IFNULL(SUM(cnt2),0) cnt2, 
					IFNULL(SUM(cnt3),0) cnt3, 
					IFNULL(SUM(cnt4),0) cnt4, 
					IFNULL(SUM(cnt5),0) cnt5, 
					IFNULL(SUM(cnt6),0) cnt6, 
					IFNULL(SUM(cnt7),0) cnt7, 
					IFNULL(SUM(cnt8),0) cnt8, 
					IFNULL(SUM(cnt9),0) cnt9, 
					IFNULL(SUM(cnt10),0) cnt10, 
					IFNULL(SUM(cnt11),0) cnt11, 
					IFNULL(SUM(cnt12),0) cnt12, 
				</isEqual>
   			      SUM(IFNULL(totSum,0)) totSum,
                  AF.form_id formId,
                  AF.form_name formName
            FROM IKEP4_APPR_FORM AF  LEFT OUTER JOIN ( 
	    		SELECT <isNotEmpty property="ym1">
	    					CASE WHEN DATE_FORMAT(stats_date, '%Y-%m') =  #ym1# THEN SUM(form_cnt) END cnt1,
	                   </isNotEmpty>
	                   <isNotEmpty property="ym2">
	                   		CASE WHEN DATE_FORMAT(stats_date, '%Y-%m') =  #ym2# THEN SUM(form_cnt) END cnt2,
	                   </isNotEmpty>
	                   <isNotEmpty property="ym3">
	                   		CASE WHEN DATE_FORMAT(stats_date, '%Y-%m') =  #ym3# THEN SUM(form_cnt) END cnt3,
	                   </isNotEmpty>
	                   <isNotEmpty property="ym4">
	                   		CASE WHEN DATE_FORMAT(stats_date, '%Y-%m') =  #ym4# THEN SUM(form_cnt) END cnt4,
	                   </isNotEmpty>
	                   <isNotEmpty property="ym5">
	                   		CASE WHEN DATE_FORMAT(stats_date, '%Y-%m') =  #ym5# THEN SUM(form_cnt) END cnt5,
	                   </isNotEmpty>
	                   <isNotEmpty property="ym6">
	                   		CASE WHEN DATE_FORMAT(stats_date, '%Y-%m') =  #ym6# THEN SUM(form_cnt) END cnt6,
	                   </isNotEmpty>
	                   <isNotEmpty property="ym7">
	                   		CASE WHEN DATE_FORMAT(stats_date, '%Y-%m') =  #ym7# THEN SUM(form_cnt) END cnt7,
	                   </isNotEmpty>
	                   <isNotEmpty property="ym8">
	                   		CASE WHEN DATE_FORMAT(stats_date, '%Y-%m') =  #ym8# THEN SUM(form_cnt) END cnt8,
	                   </isNotEmpty>
	                   <isNotEmpty property="ym9">
	                   		CASE WHEN DATE_FORMAT(stats_date, '%Y-%m') =  #ym9# THEN SUM(form_cnt) END cnt9,
	                   </isNotEmpty>
	                   <isNotEmpty property="ym10">
	                   		CASE WHEN DATE_FORMAT(stats_date, '%Y-%m') =  #ym10# THEN SUM(form_cnt) END cnt10,
	                   </isNotEmpty>
	                   <isNotEmpty property="ym11">
	                   		CASE WHEN DATE_FORMAT(stats_date, '%Y-%m') =  #ym11# THEN SUM(form_cnt) END cnt11,
	                   </isNotEmpty>
	                   <isNotEmpty property="ym12">
	                   		CASE WHEN DATE_FORMAT(stats_date, '%Y-%m') =  #ym12# THEN SUM(form_cnt) END cnt12,
	                   </isNotEmpty>
	                   SUM(form_cnt) totSum,
	                   AF.form_id,
	                   AF.form_name
	              FROM IKEP4_APPR_FORM_STATS AFS
	                   INNER JOIN IKEP4_APPR_FORM AF ON AFS.FORM_ID = AF.FORM_ID
	              WHERE AFS.stats_date BETWEEN STR_TO_DATE(#searchStartDate#,'%Y-%m-%d') AND STR_TO_DATE(#searchEndDate#,'%Y-%m-%d')
	          GROUP BY AF.form_id, AF.form_name, DATE_FORMAT(stats_date, '%Y-%m')
	       ) A ON AF.form_id = A.form_id
	     WHERE AF.FORM_PARENT_ID IN (
              							SELECT tbl1.code_id
									FROM (
									    SELECT    fncChildApprCodes() AS code_id, @level as level, @rownum as rownum
									    FROM    (SELECT  @start_with := #formParentId#, @id := @start_with, @level := 0, @rownum := 0, @code_order := -1) tb2, ikep4_appr_code
									    WHERE    @id IS NOT NULL
									) tbl2 inner join ikep4_appr_code tbl1
									ON tbl2.code_id = tbl1.code_id
              						   ) 
	    GROUP BY AF.form_name,AF.form_id
     	ORDER BY totSum DESC
	</select>
	
	<insert id="generateTimeStat">
	<![CDATA[
		INSERT INTO IKEP4_APPR_DOC_STATS (DOC_STATS_ID,
                                         DOC_STATS_TYPE,
                                         PORTAL_ID,
                                         GROUP_ID,
                                         GROUP_NAME,
                                         PARENT_GROUP_ID,
                                         GROUP_TYPE,
                                         DOC_CNT,
                                         DOC_LEAD_TIME,
                                         STATS_DATE,
                                         REGIST_DATE)
		   SELECT fncGetSeqIdgen(),
		          '0',
		          portal_id,
		          group_id,
		          group_name,
		          parent_group_id,
		          '0',
		          DOC_CNT,
		          DOC_LEAD_TIME,
		          STATS_DATE,
		          NOW()
		     FROM (  SELECT *
					  FROM (  SELECT gp.portal_id,
							         gp.GROUP_ID,
							         gp.group_name,
							         gp.parent_group_id,
					                 @start_with2 := gp.GROUP_ID,
					                 (SELECT COUNT(b.appr_id)
					                    FROM ikep4_appr_doc b
					                   WHERE b.appr_group_id IN
					                            (    SELECT A.group_id
													  FROM 
													       (SELECT fncChildGroups() AS group_id, 
													              @level as level, 
													              @rownum as rownum 
													         FROM 
													              (SELECT @start_with := @start_with2, 
													                     @id := @start_with, 
													                     @level := 0, 
													                     @rownum := 0, 
													                     @sort_order := -1 
													              ) tbl1, 
													              ikep4_ev_group 
													        WHERE @id IS NOT NULL 
													       ) tbl2 
													     INNER JOIN ikep4_ev_group A 
													         ON tbl2.group_id = A.group_id )
					                         AND b.appr_doc_status = '2'
					                         AND DATE_FORMAT(b.appr_end_date, '%Y-%m-%d') =
					                                DATE_FORMAT(DATE_ADD(NOW(),interval -1 day), '%Y-%m-%d'))
					                    DOC_CNT,
					                 (SELECT ROUND(SUM(b.appr_end_date - b.appr_req_date), 1)
					                    FROM ikep4_appr_doc b
					                   WHERE b.appr_group_id IN
					                            (    SELECT A.group_id
													  FROM 
													       (SELECT fncChildGroups() AS group_id, 
													              @level as level, 
													              @rownum as rownum 
													         FROM 
													              (SELECT @start_with := @start_with2, 
													                     @id := @start_with, 
													                     @level := 0, 
													                     @rownum := 0, 
													                     @sort_order := -1 
													              ) tbl1, 
													              ikep4_ev_group 
													        WHERE @id IS NOT NULL 
													       ) tbl2 
													     INNER JOIN ikep4_ev_group A 
													         ON tbl2.group_id = A.group_id )
					                         AND b.appr_doc_status = '2'
					                         AND DATE_FORMAT(b.appr_end_date, '%Y-%m-%d') =
					                                DATE_FORMAT(DATE_ADD(NOW(),interval -1 day), '%Y-%m-%d'))
					                    DOC_LEAD_TIME,
					                 DATE_FORMAT(DATE_ADD(NOW(),interval -1 day), '%Y-%m-%d') STATS_DATE
					            FROM    (SELECT *
					                       FROM ikep4_appr_doc
					                      WHERE appr_doc_status = '2'
					                            AND DATE_FORMAT(appr_end_date, '%Y-%m-%d') =
					                                   DATE_FORMAT(DATE_ADD(NOW(),interval -1 day), '%Y-%m-%d')) ap
								         RIGHT JOIN
								            ikep4_ev_group gp
								         ON ap.appr_group_id = gp.GROUP_ID  
								WHERE gp.GROUP_TYPE_ID = 'G0001'
								GROUP BY gp.portal_id,
								         gp.GROUP_ID,
								         gp.group_name,
								         gp.PARENT_GROUP_ID,
					                 DATE_FORMAT(ap.appr_end_date, '%Y-%m-%d')) a
					 WHERE DOC_CNT > 0) aa
	]]>
	</insert>
	
	<insert id="generateUserStat">
	<![CDATA[
		INSERT INTO IKEP4_APPR_USER_STATS (USER_STATS_ID,
                                   USER_STATS_TYPE,
                                   PORTAL_ID,
                                   USER_ID,
                                   USER_NAME,
                                   DOC_CNT,
                                   DOC_LEAD_TIME,
                                   PRE3AVG_LEAD_TIME,
                                   STATS_DATE,
                                   REGIST_DATE)
		   SELECT fncGetSeqIdgen(),
		          '0',
		          portal_id,
		          approver_id,
		          approver_name,
		          DOC_CNT,
		          DOC_LEAD_TIME,
		          PRE3AVG_LEAD_TIME,
		          STATS_DATE,
		          NOW()
		     FROM (  SELECT ad.portal_id,
		                    al.approver_id,
		                    al.approver_name,
		                    COUNT(ad.appr_id) DOC_CNT,
		                    ROUND(
		                       SUM(
		                          al.appr_date
		                          - CASE WHEN al2.appr_date = '' THEN ad.appr_req_date ELSE al2.appr_date END),
		                       1)
		                       DOC_LEAD_TIME,
		                    ROUND(
		                       AVG(
		                          al.appr_date
		                          - CASE WHEN al2.appr_date = '' THEN ad.appr_req_date ELSE al2.appr_date END),
		                       1)
		                       PRE3AVG_LEAD_TIME,
		                    DATE_FORMAT(al.appr_date, '%Y-%m-%d') STATS_DATE
		               FROM ikep4_appr_doc ad
		                    INNER JOIN ikep4_appr_line al
		                       ON ad.appr_id = al.appr_id
		                    LEFT OUTER JOIN ikep4_appr_line al2
		                       ON ad.appr_id = al2.appr_id
		                          AND al.appr_order - 1 = al2.appr_order
		              WHERE ad.appr_doc_status = '2' AND al.approver_type = '0'
		              		AND al.appr_date between DATE_FORMAT(NOW(), '%Y-%m-%d')-1 and DATE_FORMAT(NOW(), '%Y-%m-%d')
		           GROUP BY ad.portal_id,
		                    al.approver_id,
		                    al.approver_name,
		                    DATE_FORMAT(al.appr_date, '%Y-%m-%d')) aa
	]]>
	</insert>
	
	<insert id="generateFormStat">
	<![CDATA[
		INSERT INTO IKEP4_APPR_FORM_STATS (FORM_STATS_ID,
                                   PORTAL_ID,
                                   FORM_ID,
                                   PARENT_FORM_ID,
                                   SYSTEM_ID,
                                   FORM_CNT,
                                   STATS_DATE,
                                   REGIST_DATE)
		   SELECT fncGetSeqIdgen(),
		          PORTAL_ID,
		          FORM_ID,
		          FORM_PARENT_ID,
		          SYSTEM_ID,
		          FORMCNT,
		          STATS_DATE,
		          NOW()
		     FROM ( SELECT AD.PORTAL_ID, 
					       AD.FORM_ID, 
					       AF.FORM_PARENT_ID, 
					       AF.SYSTEM_ID ,
					       COUNT(AD.FORM_ID) FORMCNT ,
					       DATE_FORMAT(AD.APPR_END_DATE,'%Y-%m-%d') AS STATS_DATE  
					  FROM IKEP4_APPR_DOC AD 
					     INNER JOIN IKEP4_APPR_FORM AF 
					         ON AD.FORM_ID = AF.FORM_ID 
					 WHERE AD.APPR_DOC_STATUS = '2' 
					       AND DATE_FORMAT(AD.APPR_END_DATE,'%Y-%m-%d') = DATE_FORMAT((DATE_ADD(NOW(),interval -1 day)),'%Y-%m-%d')
					GROUP BY AD.PORTAL_ID,
					       AD.FORM_ID, 
					       AF.FORM_PARENT_ID, 
					       AF.SYSTEM_ID,
					       DATE_FORMAT(AD.APPR_END_DATE,'%Y-%m-%d') 
					) aa
	]]>
	</insert>
</sqlMap>