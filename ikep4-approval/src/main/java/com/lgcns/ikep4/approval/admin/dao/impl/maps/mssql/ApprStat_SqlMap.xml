<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd" >

<sqlMap namespace="com.lgcns.ikep4.approval.admin.dao.ApprStat" >

	<typeAlias alias="apprStat" type="com.lgcns.ikep4.approval.admin.model.ApprStat"/>
	<typeAlias alias="apprListSearchCondition"	type="com.lgcns.ikep4.approval.work.search.ApprListSearchCondition"/>
	
	
	<select id="getTimeStatList" parameterClass="apprListSearchCondition" resultClass="apprStat">
			SELECT 	 /* [ApprStat_SqlMap.xml] getTimeStatList */ 
			
						<isEqual property="ymSize" compareValue="1">
							ISNULL(SUM(cnt1),0) cnt1, ISNULL(SUM(time1),0) time1,
							0 cnt2, 0 time2,
							0 cnt3, 0 time3,
							0 cnt4, 0 time4,
							0 cnt5, 0 time5,
							0 cnt6, 0 time6,
							0 cnt7, 0 time7,
							0 cnt8, 0 time8,
							0 cnt9, 0 time9,
							0 cnt10, 0 time10,
							0 cnt11, 0 time11,
							0 cnt12, 0 time12,
						</isEqual>
						<isEqual property="ymSize" compareValue="2">
							ISNULL(SUM(cnt1),0) cnt1, ISNULL(SUM(time1),0) time1,
							ISNULL(SUM(cnt2),0) cnt2, ISNULL(SUM(time2),0) time2,
							0 cnt3, 0 time3,
							0 cnt4, 0 time4,
							0 cnt5, 0 time5,
							0 cnt6, 0 time6,
							0 cnt7, 0 time7,
							0 cnt8, 0 time8,
							0 cnt9, 0 time9,
							0 cnt10, 0 time10,
							0 cnt11, 0 time11,
							0 cnt12, 0 time12,
						</isEqual>
						<isEqual property="ymSize" compareValue="3">
							ISNULL(SUM(cnt1),0) cnt1, ISNULL(SUM(time1),0) time1,
							ISNULL(SUM(cnt2),0) cnt2, ISNULL(SUM(time2),0) time2,
							ISNULL(SUM(cnt3),0) cnt3, ISNULL(SUM(time3),0) time3,
							0 cnt4, 0 time4,
							0 cnt5, 0 time5,
							0 cnt6, 0 time6,
							0 cnt7, 0 time7,
							0 cnt8, 0 time8,
							0 cnt9, 0 time9,
							0 cnt10, 0 time10,
							0 cnt11, 0 time11,
							0 cnt12, 0 time12,
						</isEqual>
						<isEqual property="ymSize" compareValue="4">
							ISNULL(SUM(cnt1),0) cnt1, ISNULL(SUM(time1),0) time1,
							ISNULL(SUM(cnt2),0) cnt2, ISNULL(SUM(time2),0) time2,
							ISNULL(SUM(cnt3),0) cnt3, ISNULL(SUM(time3),0) time3,
							ISNULL(SUM(cnt4),0) cnt4, ISNULL(SUM(time4),0) time4,
							0 cnt5, 0 time5,
							0 cnt6, 0 time6,
							0 cnt7, 0 time7,
							0 cnt8, 0 time8,
							0 cnt9, 0 time9,
							0 cnt10, 0 time10,
							0 cnt11, 0 time11,
							0 cnt12, 0 time12,
						</isEqual>
						<isEqual property="ymSize" compareValue="5">
							ISNULL(SUM(cnt1),0) cnt1, ISNULL(SUM(time1),0) time1,
							ISNULL(SUM(cnt2),0) cnt2, ISNULL(SUM(time2),0) time2,
							ISNULL(SUM(cnt3),0) cnt3, ISNULL(SUM(time3),0) time3,
							ISNULL(SUM(cnt4),0) cnt4, ISNULL(SUM(time4),0) time4,
							ISNULL(SUM(cnt5),0) cnt5, ISNULL(SUM(time5),0) time5,
							0 cnt6, 0 time6,
							0 cnt7, 0 time7,
							0 cnt8, 0 time8,
							0 cnt9, 0 time9,
							0 cnt10, 0 time10,
							0 cnt11, 0 time11,
							0 cnt12, 0 time12,
						</isEqual>
						<isEqual property="ymSize" compareValue="6">
							ISNULL(SUM(cnt1),0) cnt1, ISNULL(SUM(time1),0) time1,
							ISNULL(SUM(cnt2),0) cnt2, ISNULL(SUM(time2),0) time2,
							ISNULL(SUM(cnt3),0) cnt3, ISNULL(SUM(time3),0) time3,
							ISNULL(SUM(cnt4),0) cnt4, ISNULL(SUM(time4),0) time4,
							ISNULL(SUM(cnt5),0) cnt5, ISNULL(SUM(time5),0) time5,
							ISNULL(SUM(cnt6),0) cnt6, ISNULL(SUM(time6),0) time6,
							0 cnt7, 0 time7,
							0 cnt8, 0 time8,
							0 cnt9, 0 time9,
							0 cnt10, 0 time10,
							0 cnt11, 0 time11,
							0 cnt12, 0 time12,
						</isEqual>
						<isEqual property="ymSize" compareValue="7">
							ISNULL(SUM(cnt1),0) cnt1, ISNULL(SUM(time1),0) time1,
							ISNULL(SUM(cnt2),0) cnt2, ISNULL(SUM(time2),0) time2,
							ISNULL(SUM(cnt3),0) cnt3, ISNULL(SUM(time3),0) time3,
							ISNULL(SUM(cnt4),0) cnt4, ISNULL(SUM(time4),0) time4,
							ISNULL(SUM(cnt5),0) cnt5, ISNULL(SUM(time5),0) time5,
							ISNULL(SUM(cnt6),0) cnt6, ISNULL(SUM(time6),0) time6,
							ISNULL(SUM(cnt7),0) cnt7, ISNULL(SUM(time7),0) time7,
							0 cnt8, 0 time8,
							0 cnt9, 0 time9,
							0 cnt10, 0 time10,
							0 cnt11, 0 time11,
							0 cnt12, 0 time12,
						</isEqual>
						<isEqual property="ymSize" compareValue="8">
							ISNULL(SUM(cnt1),0) cnt1, ISNULL(SUM(time1),0) time1,
							ISNULL(SUM(cnt2),0) cnt2, ISNULL(SUM(time2),0) time2,
							ISNULL(SUM(cnt3),0) cnt3, ISNULL(SUM(time3),0) time3,
							ISNULL(SUM(cnt4),0) cnt4, ISNULL(SUM(time4),0) time4,
							ISNULL(SUM(cnt5),0) cnt5, ISNULL(SUM(time5),0) time5,
							ISNULL(SUM(cnt6),0) cnt6, ISNULL(SUM(time6),0) time6,
							ISNULL(SUM(cnt7),0) cnt7, ISNULL(SUM(time7),0) time7,
							ISNULL(SUM(cnt8),0) cnt8, ISNULL(SUM(time8),0) time8,
							0 cnt9, 0 time9,
							0 cnt10, 0 time10,
							0 cnt11, 0 time11,
							0 cnt12, 0 time12,
						</isEqual>
						<isEqual property="ymSize" compareValue="9">
							ISNULL(SUM(cnt1),0) cnt1, ISNULL(SUM(time1),0) time1,
							ISNULL(SUM(cnt2),0) cnt2, ISNULL(SUM(time2),0) time2,
							ISNULL(SUM(cnt3),0) cnt3, ISNULL(SUM(time3),0) time3,
							ISNULL(SUM(cnt4),0) cnt4, ISNULL(SUM(time4),0) time4,
							ISNULL(SUM(cnt5),0) cnt5, ISNULL(SUM(time5),0) time5,
							ISNULL(SUM(cnt6),0) cnt6, ISNULL(SUM(time6),0) time6,
							ISNULL(SUM(cnt7),0) cnt7, ISNULL(SUM(time7),0) time7,
							ISNULL(SUM(cnt8),0) cnt8, ISNULL(SUM(time8),0) time8,
							ISNULL(SUM(cnt9),0) cnt9, ISNULL(SUM(time9),0) time9,
							0 cnt10, 0 time10,
							0 cnt11, 0 time11,
							0 cnt12, 0 time12,
						</isEqual>
						<isEqual property="ymSize" compareValue="10">
							ISNULL(SUM(cnt1),0) cnt1, ISNULL(SUM(time1),0) time1,
							ISNULL(SUM(cnt2),0) cnt2, ISNULL(SUM(time2),0) time2,
							ISNULL(SUM(cnt3),0) cnt3, ISNULL(SUM(time3),0) time3,
							ISNULL(SUM(cnt4),0) cnt4, ISNULL(SUM(time4),0) time4,
							ISNULL(SUM(cnt5),0) cnt5, ISNULL(SUM(time5),0) time5,
							ISNULL(SUM(cnt6),0) cnt6, ISNULL(SUM(time6),0) time6,
							ISNULL(SUM(cnt7),0) cnt7, ISNULL(SUM(time7),0) time7,
							ISNULL(SUM(cnt8),0) cnt8, ISNULL(SUM(time8),0) time8,
							ISNULL(SUM(cnt9),0) cnt9, ISNULL(SUM(time9),0) time9,
							ISNULL(SUM(cnt10),0) cnt10, ISNULL(SUM(time10),0) time10,
							0 cnt11, 0 time11,
							0 cnt12, 0 time12,
						</isEqual>
						<isEqual property="ymSize" compareValue="11">
							ISNULL(SUM(cnt1),0) cnt1, ISNULL(SUM(time1),0) time1,
							ISNULL(SUM(cnt2),0) cnt2, ISNULL(SUM(time2),0) time2,
							ISNULL(SUM(cnt3),0) cnt3, ISNULL(SUM(time3),0) time3,
							ISNULL(SUM(cnt4),0) cnt4, ISNULL(SUM(time4),0) time4,
							ISNULL(SUM(cnt5),0) cnt5, ISNULL(SUM(time5),0) time5,
							ISNULL(SUM(cnt6),0) cnt6, ISNULL(SUM(time6),0) time6,
							ISNULL(SUM(cnt7),0) cnt7, ISNULL(SUM(time7),0) time7,
							ISNULL(SUM(cnt8),0) cnt8, ISNULL(SUM(time8),0) time8,
							ISNULL(SUM(cnt9),0) cnt9, ISNULL(SUM(time9),0) time9,
							ISNULL(SUM(cnt10),0) cnt10, ISNULL(SUM(time10),0) time10,
							ISNULL(SUM(cnt11),0) cnt11, ISNULL(SUM(time11),0) time11,
							0 cnt12, 0 time12,
						</isEqual>
						<isEqual property="ymSize" compareValue="12">
							ISNULL(SUM(cnt1),0) cnt1, ISNULL(SUM(time1),0) time1,
							ISNULL(SUM(cnt2),0) cnt2, ISNULL(SUM(time2),0) time2,
							ISNULL(SUM(cnt3),0) cnt3, ISNULL(SUM(time3),0) time3,
							ISNULL(SUM(cnt4),0) cnt4, ISNULL(SUM(time4),0) time4,
							ISNULL(SUM(cnt5),0) cnt5, ISNULL(SUM(time5),0) time5,
							ISNULL(SUM(cnt6),0) cnt6, ISNULL(SUM(time6),0) time6,
							ISNULL(SUM(cnt7),0) cnt7, ISNULL(SUM(time7),0) time7,
							ISNULL(SUM(cnt8),0) cnt8, ISNULL(SUM(time8),0) time8,
							ISNULL(SUM(cnt9),0) cnt9, ISNULL(SUM(time9),0) time9,
							ISNULL(SUM(cnt10),0) cnt10, ISNULL(SUM(time10),0) time10,
							ISNULL(SUM(cnt11),0) cnt11, ISNULL(SUM(time11),0) time11,
							ISNULL(SUM(cnt12),0) cnt12, ISNULL(SUM(time12),0) time12,
						</isEqual>
						
				         ISNULL(SUM(cntSum),0) cntSum,
				         ISNULL(SUM(timeSum),0) timeSum,
				         b.GROUP_ID groupId,
         				 b.GROUP_NAME groupName
				    FROM (  SELECT <isNotEmpty property="ym1">
				                   		CASE WHEN CONVERT(varchar(7), stats_date,23) =  #ym1# THEN SUM (doc_cnt) END cnt1,
				                   		CASE WHEN CONVERT(varchar(7), stats_date,23) =  #ym1# THEN SUM (doc_lead_time) END time1,
				                   </isNotEmpty>
				                   <isNotEmpty property="ym2">
				                   		CASE WHEN CONVERT(varchar(7), stats_date,23) =  #ym2# THEN SUM (doc_cnt) END cnt2,
				                   		CASE WHEN CONVERT(varchar(7), stats_date,23) =  #ym2# THEN SUM (doc_lead_time) END time2,
				                   </isNotEmpty>
				                   <isNotEmpty property="ym3">
				                   		CASE WHEN CONVERT(varchar(7), stats_date,23) =  #ym3# THEN SUM (doc_cnt) END cnt3,
				                   		CASE WHEN CONVERT(varchar(7), stats_date,23) =  #ym3# THEN SUM (doc_lead_time) END time3,
				                   </isNotEmpty>
				                   <isNotEmpty property="ym4">
				                   		CASE WHEN CONVERT(varchar(7), stats_date,23) =  #ym4# THEN SUM (doc_cnt) END cnt4,
				                   		CASE WHEN CONVERT(varchar(7), stats_date,23) =  #ym4# THEN SUM (doc_lead_time) END time4,
				                   </isNotEmpty>
				                   <isNotEmpty property="ym5">
				                   		CASE WHEN CONVERT(varchar(7), stats_date,23) =  #ym5# THEN SUM (doc_cnt) END cnt5,
				                   		CASE WHEN CONVERT(varchar(7), stats_date,23) =  #ym5# THEN SUM (doc_lead_time) END time5,
				                   </isNotEmpty>
				                   <isNotEmpty property="ym6">
				                   		CASE WHEN CONVERT(varchar(7), stats_date,23) =  #ym6# THEN SUM (doc_cnt) END cnt6,
				                   		CASE WHEN CONVERT(varchar(7), stats_date,23) =  #ym6# THEN SUM (doc_lead_time) END time6,
				                   </isNotEmpty>
				                   <isNotEmpty property="ym7">
				                   		CASE WHEN CONVERT(varchar(7), stats_date,23) =  #ym7# THEN SUM (doc_cnt) END cnt7,
				                   		CASE WHEN CONVERT(varchar(7), stats_date,23) =  #ym7# THEN SUM (doc_lead_time) END time7,
				                   </isNotEmpty>
				                   <isNotEmpty property="ym8">
				                   		CASE WHEN CONVERT(varchar(7), stats_date,23) =  #ym8# THEN SUM (doc_cnt) END cnt8,
				                   		CASE WHEN CONVERT(varchar(7), stats_date,23) =  #ym8# THEN SUM (doc_lead_time) END time8,
				                   </isNotEmpty>
				                   <isNotEmpty property="ym9">
				                   		CASE WHEN CONVERT(varchar(7), stats_date,23) =  #ym9# THEN SUM (doc_cnt) END cnt9,
				                   		CASE WHEN CONVERT(varchar(7), stats_date,23) =  #ym9# THEN SUM (doc_lead_time) END time9,
				                   </isNotEmpty>
				                   <isNotEmpty property="ym10">
				                   		CASE WHEN CONVERT(varchar(7), stats_date,23) =  #ym10# THEN SUM (doc_cnt) END cnt10,
				                   		CASE WHEN CONVERT(varchar(7), stats_date,23) =  #ym10# THEN SUM (doc_lead_time) END time10,
				                   </isNotEmpty>
				                   <isNotEmpty property="ym11">
				                   		CASE WHEN CONVERT(varchar(7), stats_date,23) =  #ym11# THEN SUM (doc_cnt) END cnt11,
				                   		CASE WHEN CONVERT(varchar(7), stats_date,23) =  #ym11# THEN SUM (doc_lead_time) END time11,
				                   </isNotEmpty>
				                   <isNotEmpty property="ym12">
				                   		CASE WHEN CONVERT(varchar(7), stats_date,23) =  #ym12# THEN SUM (doc_cnt) END cnt12,
				                   		CASE WHEN CONVERT(varchar(7), stats_date,23) =  #ym12# THEN SUM (doc_lead_time) END time12,
				                   </isNotEmpty>
				                   SUM(doc_cnt) cntSum,
				                   SUM(doc_lead_time) timeSum,
				                   group_id
				              FROM IKEP4_APPR_DOC_STATS
				              WHERE stats_date BETWEEN CONVERT(DATETIME,#searchStartDate#) AND CONVERT(DATETIME,#searchEndDate#)
				              
				              <isNotEmpty property="searchGroupId">
									AND	parent_group_id = #searchGroupId#
								</isNotEmpty>

				          GROUP BY group_id, group_name, CONVERT(varchar(7), stats_date,23)) aa
						         RIGHT JOIN
						            ikep4_ev_group b
						         ON aa.GROUP_ID = b.GROUP_ID
						   WHERE b.parent_group_id = #searchGroupId# AND b.group_type_id = 'G0001'
				GROUP BY b.GROUP_ID,  b.GROUP_NAME
			 
			ORDER BY
			<isNotEmpty property="sortColumn">
				<isEqual property="sortColumn" compareValue="groupName">
		    		b.group_name
				</isEqual>
				<isEqual property="sortColumn" compareValue="cntSum">
		    		cntSum
				</isEqual>
				<isEqual property="sortColumn" compareValue="timeSum">
		    		timeSum
				</isEqual>
			</isNotEmpty>
	    	<isNotEmpty property="sortType">
		    	<isEqual property="sortType" compareValue="DESC">
		    		DESC
				</isEqual>
				<isEqual property="sortType" compareValue="ASC">
		    		ASC
				</isEqual>
			</isNotEmpty>
	</select>
	
	<select id="getUserStatList" parameterClass="apprListSearchCondition" resultClass="apprStat">
		SELECT /* [ApprStat_SqlMap.xml] getUserStatList */ 
		       *
		FROM ( 
		     SELECT Row_number() over (
		     			ORDER BY
						<isNotEmpty property="sortColumn">
							<isEqual property="sortColumn" compareValue="approverName">
					    		approverName
							</isEqual>
							<isEqual property="sortColumn" compareValue="cntSum">
					    		cntSum
							</isEqual>
							<isEqual property="sortColumn" compareValue="timeSum">
					    		timeSum
							</isEqual>
						</isNotEmpty>
				    	<isNotEmpty property="sortType">
					    	<isEqual property="sortType" compareValue="DESC">
					    		DESC
							</isEqual>
							<isEqual property="sortType" compareValue="ASC">
					    		ASC
							</isEqual>
						</isNotEmpty>
		     		) rnum,
		     		A.* 
		     		FROM ( 
					  SELECT 	 
					  			<isEqual property="ymSize" compareValue="1">
									ISNULL(SUM(cnt1),0) cnt1, ISNULL(SUM(time1),0) time1,
									0 cnt2, 0 time2,
									0 cnt3, 0 time3,
									0 cnt4, 0 time4,
									0 cnt5, 0 time5,
									0 cnt6, 0 time6,
									0 cnt7, 0 time7,
									0 cnt8, 0 time8,
									0 cnt9, 0 time9,
									0 cnt10, 0 time10,
									0 cnt11, 0 time11,
									0 cnt12, 0 time12,
								</isEqual>
								<isEqual property="ymSize" compareValue="2">
									ISNULL(SUM(cnt1),0) cnt1, ISNULL(SUM(time1),0) time1,
									ISNULL(SUM(cnt2),0) cnt2, ISNULL(SUM(time2),0) time2,
									0 cnt3, 0 time3,
									0 cnt4, 0 time4,
									0 cnt5, 0 time5,
									0 cnt6, 0 time6,
									0 cnt7, 0 time7,
									0 cnt8, 0 time8,
									0 cnt9, 0 time9,
									0 cnt10, 0 time10,
									0 cnt11, 0 time11,
									0 cnt12, 0 time12,
								</isEqual>
								<isEqual property="ymSize" compareValue="3">
									ISNULL(SUM(cnt1),0) cnt1, ISNULL(SUM(time1),0) time1,
									ISNULL(SUM(cnt2),0) cnt2, ISNULL(SUM(time2),0) time2,
									ISNULL(SUM(cnt3),0) cnt3, ISNULL(SUM(time3),0) time3,
									0 cnt4, 0 time4,
									0 cnt5, 0 time5,
									0 cnt6, 0 time6,
									0 cnt7, 0 time7,
									0 cnt8, 0 time8,
									0 cnt9, 0 time9,
									0 cnt10, 0 time10,
									0 cnt11, 0 time11,
									0 cnt12, 0 time12,
								</isEqual>
								<isEqual property="ymSize" compareValue="4">
									ISNULL(SUM(cnt1),0) cnt1, ISNULL(SUM(time1),0) time1,
									ISNULL(SUM(cnt2),0) cnt2, ISNULL(SUM(time2),0) time2,
									ISNULL(SUM(cnt3),0) cnt3, ISNULL(SUM(time3),0) time3,
									ISNULL(SUM(cnt4),0) cnt4, ISNULL(SUM(time4),0) time4,
									0 cnt5, 0 time5,
									0 cnt6, 0 time6,
									0 cnt7, 0 time7,
									0 cnt8, 0 time8,
									0 cnt9, 0 time9,
									0 cnt10, 0 time10,
									0 cnt11, 0 time11,
									0 cnt12, 0 time12,
								</isEqual>
								<isEqual property="ymSize" compareValue="5">
									ISNULL(SUM(cnt1),0) cnt1, ISNULL(SUM(time1),0) time1,
									ISNULL(SUM(cnt2),0) cnt2, ISNULL(SUM(time2),0) time2,
									ISNULL(SUM(cnt3),0) cnt3, ISNULL(SUM(time3),0) time3,
									ISNULL(SUM(cnt4),0) cnt4, ISNULL(SUM(time4),0) time4,
									ISNULL(SUM(cnt5),0) cnt5, ISNULL(SUM(time5),0) time5,
									0 cnt6, 0 time6,
									0 cnt7, 0 time7,
									0 cnt8, 0 time8,
									0 cnt9, 0 time9,
									0 cnt10, 0 time10,
									0 cnt11, 0 time11,
									0 cnt12, 0 time12,
								</isEqual>
								<isEqual property="ymSize" compareValue="6">
									ISNULL(SUM(cnt1),0) cnt1, ISNULL(SUM(time1),0) time1,
									ISNULL(SUM(cnt2),0) cnt2, ISNULL(SUM(time2),0) time2,
									ISNULL(SUM(cnt3),0) cnt3, ISNULL(SUM(time3),0) time3,
									ISNULL(SUM(cnt4),0) cnt4, ISNULL(SUM(time4),0) time4,
									ISNULL(SUM(cnt5),0) cnt5, ISNULL(SUM(time5),0) time5,
									ISNULL(SUM(cnt6),0) cnt6, ISNULL(SUM(time6),0) time6,
									0 cnt7, 0 time7,
									0 cnt8, 0 time8,
									0 cnt9, 0 time9,
									0 cnt10, 0 time10,
									0 cnt11, 0 time11,
									0 cnt12, 0 time12,
								</isEqual>
								<isEqual property="ymSize" compareValue="7">
									ISNULL(SUM(cnt1),0) cnt1, ISNULL(SUM(time1),0) time1,
									ISNULL(SUM(cnt2),0) cnt2, ISNULL(SUM(time2),0) time2,
									ISNULL(SUM(cnt3),0) cnt3, ISNULL(SUM(time3),0) time3,
									ISNULL(SUM(cnt4),0) cnt4, ISNULL(SUM(time4),0) time4,
									ISNULL(SUM(cnt5),0) cnt5, ISNULL(SUM(time5),0) time5,
									ISNULL(SUM(cnt6),0) cnt6, ISNULL(SUM(time6),0) time6,
									ISNULL(SUM(cnt7),0) cnt7, ISNULL(SUM(time7),0) time7,
									0 cnt8, 0 time8,
									0 cnt9, 0 time9,
									0 cnt10, 0 time10,
									0 cnt11, 0 time11,
									0 cnt12, 0 time12,
								</isEqual>
								<isEqual property="ymSize" compareValue="8">
									ISNULL(SUM(cnt1),0) cnt1, ISNULL(SUM(time1),0) time1,
									ISNULL(SUM(cnt2),0) cnt2, ISNULL(SUM(time2),0) time2,
									ISNULL(SUM(cnt3),0) cnt3, ISNULL(SUM(time3),0) time3,
									ISNULL(SUM(cnt4),0) cnt4, ISNULL(SUM(time4),0) time4,
									ISNULL(SUM(cnt5),0) cnt5, ISNULL(SUM(time5),0) time5,
									ISNULL(SUM(cnt6),0) cnt6, ISNULL(SUM(time6),0) time6,
									ISNULL(SUM(cnt7),0) cnt7, ISNULL(SUM(time7),0) time7,
									ISNULL(SUM(cnt8),0) cnt8, ISNULL(SUM(time8),0) time8,
									0 cnt9, 0 time9,
									0 cnt10, 0 time10,
									0 cnt11, 0 time11,
									0 cnt12, 0 time12,
								</isEqual>
								<isEqual property="ymSize" compareValue="9">
									ISNULL(SUM(cnt1),0) cnt1, ISNULL(SUM(time1),0) time1,
									ISNULL(SUM(cnt2),0) cnt2, ISNULL(SUM(time2),0) time2,
									ISNULL(SUM(cnt3),0) cnt3, ISNULL(SUM(time3),0) time3,
									ISNULL(SUM(cnt4),0) cnt4, ISNULL(SUM(time4),0) time4,
									ISNULL(SUM(cnt5),0) cnt5, ISNULL(SUM(time5),0) time5,
									ISNULL(SUM(cnt6),0) cnt6, ISNULL(SUM(time6),0) time6,
									ISNULL(SUM(cnt7),0) cnt7, ISNULL(SUM(time7),0) time7,
									ISNULL(SUM(cnt8),0) cnt8, ISNULL(SUM(time8),0) time8,
									ISNULL(SUM(cnt9),0) cnt9, ISNULL(SUM(time9),0) time9,
									0 cnt10, 0 time10,
									0 cnt11, 0 time11,
									0 cnt12, 0 time12,
								</isEqual>
								<isEqual property="ymSize" compareValue="10">
									ISNULL(SUM(cnt1),0) cnt1, ISNULL(SUM(time1),0) time1,
									ISNULL(SUM(cnt2),0) cnt2, ISNULL(SUM(time2),0) time2,
									ISNULL(SUM(cnt3),0) cnt3, ISNULL(SUM(time3),0) time3,
									ISNULL(SUM(cnt4),0) cnt4, ISNULL(SUM(time4),0) time4,
									ISNULL(SUM(cnt5),0) cnt5, ISNULL(SUM(time5),0) time5,
									ISNULL(SUM(cnt6),0) cnt6, ISNULL(SUM(time6),0) time6,
									ISNULL(SUM(cnt7),0) cnt7, ISNULL(SUM(time7),0) time7,
									ISNULL(SUM(cnt8),0) cnt8, ISNULL(SUM(time8),0) time8,
									ISNULL(SUM(cnt9),0) cnt9, ISNULL(SUM(time9),0) time9,
									ISNULL(SUM(cnt10),0) cnt10, ISNULL(SUM(time10),0) time10,
									0 cnt11, 0 time11,
									0 cnt12, 0 time12,
								</isEqual>
								<isEqual property="ymSize" compareValue="11">
									ISNULL(SUM(cnt1),0) cnt1, ISNULL(SUM(time1),0) time1,
									ISNULL(SUM(cnt2),0) cnt2, ISNULL(SUM(time2),0) time2,
									ISNULL(SUM(cnt3),0) cnt3, ISNULL(SUM(time3),0) time3,
									ISNULL(SUM(cnt4),0) cnt4, ISNULL(SUM(time4),0) time4,
									ISNULL(SUM(cnt5),0) cnt5, ISNULL(SUM(time5),0) time5,
									ISNULL(SUM(cnt6),0) cnt6, ISNULL(SUM(time6),0) time6,
									ISNULL(SUM(cnt7),0) cnt7, ISNULL(SUM(time7),0) time7,
									ISNULL(SUM(cnt8),0) cnt8, ISNULL(SUM(time8),0) time8,
									ISNULL(SUM(cnt9),0) cnt9, ISNULL(SUM(time9),0) time9,
									ISNULL(SUM(cnt10),0) cnt10, ISNULL(SUM(time10),0) time10,
									ISNULL(SUM(cnt11),0) cnt11, ISNULL(SUM(time11),0) time11,
									0 cnt12, 0 time12,
								</isEqual>
								<isEqual property="ymSize" compareValue="12">
									ISNULL(SUM(cnt1),0) cnt1, ISNULL(SUM(time1),0) time1,
									ISNULL(SUM(cnt2),0) cnt2, ISNULL(SUM(time2),0) time2,
									ISNULL(SUM(cnt3),0) cnt3, ISNULL(SUM(time3),0) time3,
									ISNULL(SUM(cnt4),0) cnt4, ISNULL(SUM(time4),0) time4,
									ISNULL(SUM(cnt5),0) cnt5, ISNULL(SUM(time5),0) time5,
									ISNULL(SUM(cnt6),0) cnt6, ISNULL(SUM(time6),0) time6,
									ISNULL(SUM(cnt7),0) cnt7, ISNULL(SUM(time7),0) time7,
									ISNULL(SUM(cnt8),0) cnt8, ISNULL(SUM(time8),0) time8,
									ISNULL(SUM(cnt9),0) cnt9, ISNULL(SUM(time9),0) time9,
									ISNULL(SUM(cnt10),0) cnt10, ISNULL(SUM(time10),0) time10,
									ISNULL(SUM(cnt11),0) cnt11, ISNULL(SUM(time11),0) time11,
									ISNULL(SUM(cnt12),0) cnt12, ISNULL(SUM(time12),0) time12,
								</isEqual>
						
						         ISNULL(SUM(cntSum),0) cntSum,
						         ISNULL(SUM(timeSum),0) timeSum,
						         user_id approverId,
						         user_name approverName
						    FROM (  SELECT <isNotEmpty property="ym1">
						                   		CASE WHEN CONVERT(varchar(7), stats_date,23) =  #ym1# THEN SUM (doc_cnt) END cnt1,
						                   		CASE WHEN CONVERT(varchar(7), stats_date,23) =  #ym1# THEN SUM (doc_lead_time) END time1,
						                   </isNotEmpty>
						                   <isNotEmpty property="ym2">
						                   		CASE WHEN CONVERT(varchar(7), stats_date,23) =  #ym2# THEN SUM (doc_cnt) END cnt2,
						                   		CASE WHEN CONVERT(varchar(7), stats_date,23) =  #ym2# THEN SUM (doc_lead_time) END time2,
						                   </isNotEmpty>
						                   <isNotEmpty property="ym3">
						                   		CASE WHEN CONVERT(varchar(7), stats_date,23) =  #ym3# THEN SUM (doc_cnt) END cnt3,
						                   		CASE WHEN CONVERT(varchar(7), stats_date,23) =  #ym3# THEN SUM (doc_lead_time) END time3,
						                   </isNotEmpty>
						                   <isNotEmpty property="ym4">
						                   		CASE WHEN CONVERT(varchar(7), stats_date,23) =  #ym4# THEN SUM (doc_cnt) END cnt4,
						                   		CASE WHEN CONVERT(varchar(7), stats_date,23) =  #ym4# THEN SUM (doc_lead_time) END time4,
						                   </isNotEmpty>
						                   <isNotEmpty property="ym5">
						                   		CASE WHEN CONVERT(varchar(7), stats_date,23) =  #ym5# THEN SUM (doc_cnt) END cnt5,
						                   		CASE WHEN CONVERT(varchar(7), stats_date,23) =  #ym5# THEN SUM (doc_lead_time) END time5,
						                   </isNotEmpty>
						                   <isNotEmpty property="ym6">
						                   		CASE WHEN CONVERT(varchar(7), stats_date,23) =  #ym6# THEN SUM (doc_cnt) END cnt6,
						                   		CASE WHEN CONVERT(varchar(7), stats_date,23) =  #ym6# THEN SUM (doc_lead_time) END time6,
						                   </isNotEmpty>
						                   <isNotEmpty property="ym7">
						                   		CASE WHEN CONVERT(varchar(7), stats_date,23) =  #ym7# THEN SUM (doc_cnt) END cnt7,
						                   		CASE WHEN CONVERT(varchar(7), stats_date,23) =  #ym7# THEN SUM (doc_lead_time) END time7,
						                   </isNotEmpty>
						                   <isNotEmpty property="ym8">
						                   		CASE WHEN CONVERT(varchar(7), stats_date,23) =  #ym8# THEN SUM (doc_cnt) END cnt8,
						                   		CASE WHEN CONVERT(varchar(7), stats_date,23) =  #ym8# THEN SUM (doc_lead_time) END time8,
						                   </isNotEmpty>
						                   <isNotEmpty property="ym9">
						                   		CASE WHEN CONVERT(varchar(7), stats_date,23) =  #ym9# THEN SUM (doc_cnt) END cnt9,
						                   		CASE WHEN CONVERT(varchar(7), stats_date,23) =  #ym9# THEN SUM (doc_lead_time) END time9,
						                   </isNotEmpty>
						                   <isNotEmpty property="ym10">
						                   		CASE WHEN CONVERT(varchar(7), stats_date,23) =  #ym10# THEN SUM (doc_cnt) END cnt10,
						                   		CASE WHEN CONVERT(varchar(7), stats_date,23) =  #ym10# THEN SUM (doc_lead_time) END time10,
						                   </isNotEmpty>
						                   <isNotEmpty property="ym11">
						                   		CASE WHEN CONVERT(varchar(7), stats_date,23) =  #ym11# THEN SUM (doc_cnt) END cnt11,
						                   		CASE WHEN CONVERT(varchar(7), stats_date,23) =  #ym11# THEN SUM (doc_lead_time) END time11,
						                   </isNotEmpty>
						                   <isNotEmpty property="ym12">
						                   		CASE WHEN CONVERT(varchar(7), stats_date,23) =  #ym12# THEN SUM (doc_cnt) END cnt12,
						                   		CASE WHEN CONVERT(varchar(7), stats_date,23) =  #ym12# THEN SUM (doc_lead_time) END time12,
						                   </isNotEmpty>
						                   
						                   SUM(doc_cnt) cntSum,
						                   SUM(doc_lead_time) timeSum,
						                   user_id,
						                   user_name
						              FROM IKEP4_APPR_USER_STATS
						              WHERE stats_date BETWEEN CONVERT(DATETIME,#searchStartDate#) AND CONVERT(DATETIME,#searchEndDate#)
						              
						              <isNotEmpty property="searchApprTitle">
											AND	UPPER(user_name) LIKE '%' || UPPER(#searchApprTitle#) || '%'
										</isNotEmpty>

						          GROUP BY user_id, user_name, CONVERT(varchar(7), stats_date,23)) aa
						GROUP BY user_id, user_name
					 
				) a
		<![CDATA[  
		       ) aa
     	WHERE  aa.rnum  > #startRowIndex#
        AND aa.rnum  <= #endRowIndex#
		]]> 	
	</select>
	
	<select id="getUserStatCount" parameterClass="apprListSearchCondition" resultClass="int">
	
		  SELECT 	 /* [ApprStat_SqlMap.xml] getUserStatCount */
			count(*) 
				FROM (
						SELECT  user_id,
						        user_name
						    FROM (  SELECT user_id,
						                   user_name
						              FROM IKEP4_APPR_USER_STATS
						              WHERE stats_date BETWEEN CONVERT(DATETIME,#searchStartDate#) AND CONVERT(DATETIME,#searchEndDate#)
						              
						              <isNotEmpty property="searchApprTitle">
											AND	UPPER(user_name) LIKE '%' || UPPER(#searchApprTitle#) || '%'
										</isNotEmpty>
					
						          GROUP BY user_id, user_name, CONVERT(varchar(7), stats_date,23)) aa
						GROUP BY user_id, user_name) bb

	</select>
	
	<select id="getFormStatList" parameterClass="apprListSearchCondition" resultClass="apprStat">
		/* [ApprStat_SqlMap.xml] getFormStatList */ 
   		SELECT  <isEqual property="ymSize" compareValue="1">
					ISNULL(SUM(cnt1),0) cnt1, 
					0 cnt2, 
					0 cnt3, 
					0 cnt4, 
					0 cnt5, 
					0 cnt6, 
					0 cnt7, 
					0 cnt8, 
					0 cnt9, 
					0 cnt10, 
					0 cnt11, 
					0 cnt12, 
				</isEqual>
				<isEqual property="ymSize" compareValue="2">
					ISNULL(SUM(cnt1),0) cnt1, 
					ISNULL(SUM(cnt2),0) cnt2, 
					0 cnt3, 
					0 cnt4, 
					0 cnt5, 
					0 cnt6, 
					0 cnt7, 
					0 cnt8, 
					0 cnt9, 
					0 cnt10, 
					0 cnt11, 
					0 cnt12, 
				</isEqual>
				<isEqual property="ymSize" compareValue="3">
					ISNULL(SUM(cnt1),0) cnt1, 
					ISNULL(SUM(cnt2),0) cnt2, 
					ISNULL(SUM(cnt3),0) cnt3, 
					0 cnt4, 
					0 cnt5, 
					0 cnt6, 
					0 cnt7, 
					0 cnt8, 
					0 cnt9, 
					0 cnt10, 
					0 cnt11, 
					0 cnt12, 
				</isEqual>
				<isEqual property="ymSize" compareValue="4">
					ISNULL(SUM(cnt1),0) cnt1, 
					ISNULL(SUM(cnt2),0) cnt2, 
					ISNULL(SUM(cnt3),0) cnt3, 
					ISNULL(SUM(cnt4),0) cnt4, 
					0 cnt5, 
					0 cnt6, 
					0 cnt7, 
					0 cnt8, 
					0 cnt9, 
					0 cnt10, 
					0 cnt11, 
					0 cnt12, 
				</isEqual>
				<isEqual property="ymSize" compareValue="5">
					ISNULL(SUM(cnt1),0) cnt1, 
					ISNULL(SUM(cnt2),0) cnt2, 
					ISNULL(SUM(cnt3),0) cnt3, 
					ISNULL(SUM(cnt4),0) cnt4, 
					ISNULL(SUM(cnt5),0) cnt5, 
					0 cnt6, 
					0 cnt7, 
					0 cnt8, 
					0 cnt9, 
					0 cnt10, 
					0 cnt11, 
					0 cnt12, 
				</isEqual>
				<isEqual property="ymSize" compareValue="6">
					ISNULL(SUM(cnt1),0) cnt1, 
					ISNULL(SUM(cnt2),0) cnt2, 
					ISNULL(SUM(cnt3),0) cnt3, 
					ISNULL(SUM(cnt4),0) cnt4, 
					ISNULL(SUM(cnt5),0) cnt5, 
					ISNULL(SUM(cnt6),0) cnt6, 
					0 cnt7, 
					0 cnt8, 
					0 cnt9, 
					0 cnt10, 
					0 cnt11, 
					0 cnt12, 
				</isEqual>
				<isEqual property="ymSize" compareValue="7">
					ISNULL(SUM(cnt1),0) cnt1, 
					ISNULL(SUM(cnt2),0) cnt2, 
					ISNULL(SUM(cnt3),0) cnt3, 
					ISNULL(SUM(cnt4),0) cnt4, 
					ISNULL(SUM(cnt5),0) cnt5, 
					ISNULL(SUM(cnt6),0) cnt6, 
					ISNULL(SUM(cnt7),0) cnt7, 
					0 cnt8, 
					0 cnt9, 
					0 cnt10, 
					0 cnt11, 
					0 cnt12, 
				</isEqual>
				<isEqual property="ymSize" compareValue="8">
					ISNULL(SUM(cnt1),0) cnt1, 
					ISNULL(SUM(cnt2),0) cnt2, 
					ISNULL(SUM(cnt3),0) cnt3, 
					ISNULL(SUM(cnt4),0) cnt4, 
					ISNULL(SUM(cnt5),0) cnt5, 
					ISNULL(SUM(cnt6),0) cnt6, 
					ISNULL(SUM(cnt7),0) cnt7, 
					ISNULL(SUM(cnt8),0) cnt8, 
					0 cnt9, 
					0 cnt10, 
					0 cnt11, 
					0 cnt12, 
				</isEqual>
				<isEqual property="ymSize" compareValue="9">
					ISNULL(SUM(cnt1),0) cnt1, 
					ISNULL(SUM(cnt2),0) cnt2, 
					ISNULL(SUM(cnt3),0) cnt3, 
					ISNULL(SUM(cnt4),0) cnt4, 
					ISNULL(SUM(cnt5),0) cnt5, 
					ISNULL(SUM(cnt6),0) cnt6,
					ISNULL(SUM(cnt7),0) cnt7, 
					ISNULL(SUM(cnt8),0) cnt8, 
					ISNULL(SUM(cnt9),0) cnt9, 
					0 cnt10, 
					0 cnt11, 
					0 cnt12, 
				</isEqual>
				<isEqual property="ymSize" compareValue="10">
					ISNULL(SUM(cnt1),0) cnt1, 
					ISNULL(SUM(cnt2),0) cnt2, 
					ISNULL(SUM(cnt3),0) cnt3, 
					ISNULL(SUM(cnt4),0) cnt4, 
					ISNULL(SUM(cnt5),0) cnt5, 
					ISNULL(SUM(cnt6),0) cnt6, 
					ISNULL(SUM(cnt7),0) cnt7, 
					ISNULL(SUM(cnt8),0) cnt8, 
					ISNULL(SUM(cnt9),0) cnt9, 
					ISNULL(SUM(cnt10),0) cnt10, 
					0 cnt11, 
					0 cnt12, 
				</isEqual>
				<isEqual property="ymSize" compareValue="11">
					ISNULL(SUM(cnt1),0) cnt1, 
					ISNULL(SUM(cnt2),0) cnt2, 
					ISNULL(SUM(cnt3),0) cnt3, 
					ISNULL(SUM(cnt4),0) cnt4, 
					ISNULL(SUM(cnt5),0) cnt5, 
					ISNULL(SUM(cnt6),0) cnt6, 
					ISNULL(SUM(cnt7),0) cnt7, 
					ISNULL(SUM(cnt8),0) cnt8, 
					ISNULL(SUM(cnt9),0) cnt9, 
					ISNULL(SUM(cnt10),0) cnt10, 
					ISNULL(SUM(cnt11),0) cnt11, 
					0 cnt12, 
				</isEqual>
				<isEqual property="ymSize" compareValue="12">
					ISNULL(SUM(cnt1),0) cnt1, 
					ISNULL(SUM(cnt2),0) cnt2, 
					ISNULL(SUM(cnt3),0) cnt3, 
					ISNULL(SUM(cnt4),0) cnt4, 
					ISNULL(SUM(cnt5),0) cnt5, 
					ISNULL(SUM(cnt6),0) cnt6, 
					ISNULL(SUM(cnt7),0) cnt7, 
					ISNULL(SUM(cnt8),0) cnt8, 
					ISNULL(SUM(cnt9),0) cnt9, 
					ISNULL(SUM(cnt10),0) cnt10, 
					ISNULL(SUM(cnt11),0) cnt11, 
					ISNULL(SUM(cnt12),0) cnt12, 
				</isEqual>
   			      SUM(ISNULL(totSum,0)) totSum,
                  AF.form_id formId,
                  AF.form_name formName
            FROM IKEP4_APPR_FORM AF  LEFT OUTER JOIN ( 
	    		SELECT <isNotEmpty property="ym1">
	    					CASE WHEN CONVERT(varchar(7), stats_date,23) =  #ym1# THEN SUM (form_cnt) END cnt1,
	                   </isNotEmpty>
	                   <isNotEmpty property="ym2">
	                   		CASE WHEN CONVERT(varchar(7), stats_date,23) =  #ym2# THEN SUM (form_cnt) END cnt2,
	                   </isNotEmpty>
	                   <isNotEmpty property="ym3">
	                   		CASE WHEN CONVERT(varchar(7), stats_date,23) =  #ym3# THEN SUM (form_cnt) END cnt3,
	                   </isNotEmpty>
	                   <isNotEmpty property="ym4">
	                   		CASE WHEN CONVERT(varchar(7), stats_date,23) =  #ym4# THEN SUM (form_cnt) END cnt4,
	                   </isNotEmpty>
	                   <isNotEmpty property="ym5">
	                   		CASE WHEN CONVERT(varchar(7), stats_date,23) =  #ym5# THEN SUM (form_cnt) END cnt5,
	                   </isNotEmpty>
	                   <isNotEmpty property="ym6">
	                   		CASE WHEN CONVERT(varchar(7), stats_date,23) =  #ym6# THEN SUM (form_cnt) END cnt6,
	                   </isNotEmpty>
	                   <isNotEmpty property="ym7">
	                   		CASE WHEN CONVERT(varchar(7), stats_date,23) =  #ym7# THEN SUM (form_cnt) END cnt7,
	                   </isNotEmpty>
	                   <isNotEmpty property="ym8">
	                   		CASE WHEN CONVERT(varchar(7), stats_date,23) =  #ym8# THEN SUM (form_cnt) END cnt8,
	                   </isNotEmpty>
	                   <isNotEmpty property="ym9">
	                   		CASE WHEN CONVERT(varchar(7), stats_date,23) =  #ym9# THEN SUM (form_cnt) END cnt9,
	                   </isNotEmpty>
	                   <isNotEmpty property="ym10">
	                   		CASE WHEN CONVERT(varchar(7), stats_date,23) =  #ym10# THEN SUM (form_cnt) END cnt10,
	                   </isNotEmpty>
	                   <isNotEmpty property="ym11">
	                   		CASE WHEN CONVERT(varchar(7), stats_date,23) =  #ym11# THEN SUM (form_cnt) END cnt11,
	                   </isNotEmpty>
	                   <isNotEmpty property="ym12">
	                   		CASE WHEN CONVERT(varchar(7), stats_date,23) =  #ym12# THEN SUM (form_cnt) END cnt12,
	                   </isNotEmpty>
	                   SUM(form_cnt) totSum,
	                   AF.form_id,
	                   AF.form_name
	              FROM IKEP4_APPR_FORM_STATS AFS
	                   INNER JOIN IKEP4_APPR_FORM AF ON AFS.FORM_ID = AF.FORM_ID
	              WHERE AFS.stats_date BETWEEN CONVERT(DATETIME,#searchStartDate#) AND CONVERT(DATETIME,#searchEndDate#)
	          GROUP BY AF.form_id, AF.form_name, CONVERT(varchar(7), stats_date,23)
	       ) A ON AF.form_id = A.form_id
	     WHERE AF.FORM_PARENT_ID IN (SELECT CODE_ID FROM dbo.FN_APPR_CODE_LIST (#formParentId#)) 
	    GROUP BY AF.form_name,AF.form_id
     	ORDER BY totSum DESC 
	</select>
	
	<insert id="generateTimeStat">
	<![CDATA[
		INSERT INTO IKEP4_APPR_DOC_STATS (DOC_STATS_ID,
                                         DOC_STATS_TYPE,
                                         PORTAL_ID,
                                         GROUP_ID,
                                         GROUP_NAME,
                                         PARENT_GROUP_ID,
                                         GROUP_TYPE,
                                         DOC_CNT,
                                         DOC_LEAD_TIME,
                                         STATS_DATE,
                                         REGIST_DATE)
		   SELECT (Row_Number() over (order by portal_id)) + (SELECT ISNULL(MAX(DOC_STATS_ID),1) FROM IKEP4_APPR_DOC_STATS),
		          '0',
		          portal_id,
		          group_id,
		          group_name,
		          parent_group_id,
		          '0',
		          DOC_CNT,
		          DOC_LEAD_TIME,
		          STATS_DATE,
		          GETDATE()
		     FROM (  SELECT *
					  FROM (  SELECT gp.portal_id,
							         gp.GROUP_ID,
							         gp.group_name,
							         gp.parent_group_id,
					                 (SELECT COUNT (b.appr_id)
					                    FROM ikep4_appr_doc b
					                   WHERE b.appr_group_id IN
					                            (    
					                            	select group_id from fn_child_group_list(gp.GROUP_ID)
					                             )
					                         AND b.appr_doc_status = '2'
					                         AND CONVERT(varchar,b.appr_end_date, 23) =
					                                CONVERT(varchar,GETDATE()-1, 23))
					                    DOC_CNT,
					                 (SELECT ROUND (SUM (-DATEDIFF (dd, b.appr_end_date, b.appr_req_date)), 1)
					                    FROM ikep4_appr_doc b
					                   WHERE b.appr_group_id IN
					                            (    
						                            select group_id from fn_child_group_list(gp.GROUP_ID)
					                             )
					                         AND b.appr_doc_status = '2'
					                         AND CONVERT(varchar,b.appr_end_date, 23) =
					                                CONVERT(varchar,GETDATE()-1, 23))
					                    DOC_LEAD_TIME,
					                 	CONVERT(VARCHAR,GETDATE()-1,23)  STATS_DATE
					            FROM    (SELECT *
					                       FROM ikep4_appr_doc
					                      WHERE appr_doc_status = '2'
					                            AND CONVERT(varchar,appr_end_date, 23) =
					                                   CONVERT(varchar,GETDATE()-1, 23))ap
								         RIGHT JOIN
								            ikep4_ev_group gp
								         ON ap.appr_group_id = gp.GROUP_ID 
								WHERE gp.GROUP_TYPE_ID = 'G0001'
								GROUP BY gp.portal_id,
								         gp.GROUP_ID,
								         gp.group_name,
								         gp.PARENT_GROUP_ID,
						                 CONVERT(varchar,ap.appr_end_date, 23)) a
					 WHERE DOC_CNT > 0) aa
	]]>
	</insert>
	
	<insert id="generateUserStat">
	<![CDATA[
		INSERT INTO IKEP4_APPR_USER_STATS (USER_STATS_ID,
                                   USER_STATS_TYPE,
                                   PORTAL_ID,
                                   USER_ID,
                                   USER_NAME,
                                   DOC_CNT,
                                   DOC_LEAD_TIME,
                                   PRE3AVG_LEAD_TIME,
                                   STATS_DATE,
                                   REGIST_DATE)
		   SELECT (Row_Number() over (order by portal_id)) + (SELECT ISNULL(MAX(USER_STATS_ID),1) FROM IKEP4_APPR_USER_STATS),
		          '0',
		          portal_id,
		          approver_id,
		          approver_name,
		          DOC_CNT,
		          DOC_LEAD_TIME,
		          PRE3AVG_LEAD_TIME,
		          STATS_DATE,
		          GETDATE()
		     FROM (  SELECT ad.portal_id,
		                    al.approver_id,
		                    al.approver_name,
		                    COUNT (ad.appr_id) DOC_CNT,
		                    ROUND (
		                       SUM (
		                          -DATEDIFF (dd, al.appr_date,
		                          	CASE WHEN al2.appr_date = '' THEN ad.appr_req_date ELSE al2.appr_date END)),
		                       1)
		                       DOC_LEAD_TIME,
		                    ROUND (
		                       AVG (
		                          -DATEDIFF (dd, al.appr_date,
		                          	CASE WHEN al2.appr_date = '' THEN ad.appr_req_date ELSE al2.appr_date END)),
		                       1)
		                       PRE3AVG_LEAD_TIME,
		                    CONVERT(varchar,al.appr_date, 23) STATS_DATE
		               FROM ikep4_appr_doc ad
		                    INNER JOIN ikep4_appr_line al
		                       ON ad.appr_id = al.appr_id
		                    LEFT OUTER JOIN ikep4_appr_line al2
		                       ON ad.appr_id = al2.appr_id
		                          AND al.appr_order - 1 = al2.appr_order
		              WHERE ad.appr_doc_status = '2' AND al.approver_type = '0'
		              		AND al.appr_date between CONVERT(DATETIME,GETDATE())-1 and CONVERT(DATETIME,GETDATE())
		           GROUP BY ad.portal_id,
		                    al.approver_id,
		                    al.approver_name,
		                    CONVERT(varchar,al.appr_date, 23)) aa
	]]>
	</insert>
	
	<insert id="generateFormStat">
	<![CDATA[
		INSERT INTO IKEP4_APPR_FORM_STATS (FORM_STATS_ID,
                                   PORTAL_ID,
                                   FORM_ID,
                                   PARENT_FORM_ID,
                                   SYSTEM_ID,
                                   FORM_CNT,
                                   STATS_DATE,
                                   REGIST_DATE)
		   SELECT (Row_Number() over (order by portal_id)) + (SELECT ISNULL(MAX(FORM_STATS_ID),1) FROM IKEP4_APPR_FORM_STATS),
		          PORTAL_ID,
		          FORM_ID,
		          FORM_PARENT_ID,
		          SYSTEM_ID,
		          FORMCNT,
		          STATS_DATE,
		          GETDATE()
		     FROM ( SELECT AD.PORTAL_ID, 
					       AD.FORM_ID, 
					       AF.FORM_PARENT_ID, 
					       AF.SYSTEM_ID ,
					       COUNT(AD.FORM_ID) FORMCNT ,
					       CONVERT(DATETIME,CONVERT(varchar,AD.APPR_END_DATE,23)) AS STATS_DATE  
					  FROM IKEP4_APPR_DOC AD 
					     INNER JOIN IKEP4_APPR_FORM AF 
					         ON AD.FORM_ID = AF.FORM_ID 
					 WHERE AD.APPR_DOC_STATUS = '2' 
					       AND CONVERT(varchar,AD.APPR_END_DATE,23) = CONVERT(varchar,(GETDATE()-1),23)
					GROUP BY AD.PORTAL_ID,
					       AD.FORM_ID, 
					       AF.FORM_PARENT_ID, 
					       AF.SYSTEM_ID,
					       CONVERT(varchar,AD.APPR_END_DATE,23) 
					) aa
	]]>
	</insert>
</sqlMap>